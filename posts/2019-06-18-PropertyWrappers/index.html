<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Warp your mobile development"/><link rel="canonical" href="http://blog.warpfactor.io/posts/2019-06-18-PropertyWrappers"/><meta name="twitter:url" content="http://blog.warpfactor.io/posts/2019-06-18-PropertyWrappers"/><meta name="og:url" content="http://blog.warpfactor.io/posts/2019-06-18-PropertyWrappers"/><title>Property Wrappers In Swift 5.1, The Missing Published Implementation | Warp your mobile development</title><meta name="twitter:title" content="Property Wrappers In Swift 5.1, The Missing Published Implementation | Warp your mobile development"/><meta name="og:title" content="Property Wrappers In Swift 5.1, The Missing Published Implementation | Warp your mobile development"/><meta name="description" content="It‚Äôs been an amazing WWDC this year. SwiftUI and Combine were some big announcements of the conference. They will have a huge impact on our daily life as iOS developers."/><meta name="twitter:description" content="It‚Äôs been an amazing WWDC this year. SwiftUI and Combine were some big announcements of the conference. They will have a huge impact on our daily life as iOS developers."/><meta name="og:description" content="It‚Äôs been an amazing WWDC this year. SwiftUI and Combine were some big announcements of the conference. They will have a huge impact on our daily life as iOS developers."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Warp your mobile development"/></head><head>                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109460106-1"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'UA-109460106-1');
                </script></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üçè</span><span class="hidden md:block w-0 md:w-auto pl-1">Warp your mobile development</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/projects">PROJECTS</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/posts">MY POSTS</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">18 JUNE 2019<span class="text-gray-900 px-1">/</span><a href="/tags/language">LANGUAGE</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">Property Wrappers In Swift 5.1, The Missing Published Implementation</h1></div><div class="container w-full max-w-6xl h-48 md:h-cover mx-auto bg-white bg-cover bg-center mt-8 sm:rounded" style="background-color: #465059; background-image:url('/Images/2019-06-18-PropertyWrappers/wrapper.png');"></div><div class="container max-w-5xl mx-auto md:-mt-32"><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><p>It‚Äôs been an amazing WWDC this year. <strong>SwiftUI</strong> and <strong>Combine</strong> were some big announcements of the conference. They will have a huge impact on our daily life as iOS developers.</p><ul><li><a href="https://developer.apple.com/xcode/swiftui/"><strong>SwiftUI</strong></a> is Apple‚Äôs new framework for writing user interfaces natively on all Apple platforms in a declarative and highly composable way.</li></ul><ul><li><a href="https://developer.apple.com/documentation/combine"><strong>Combine</strong></a> is Apple‚Äôs new unified declarative framework for processing values over time. This is a roundabout way of talking about reactive programming, of which RxSwift and ReactiveCocoa are the ambassadors.</li></ul><p>This article is not truly about these frameworks. It is about a feature that powers SwiftUI and makes Combine easily compliant with UIKit: <strong>property wrappers</strong>.</p><h1>Property Wrappers</h1><p>Also known as <strong>property delegates</strong>, property wrapper is not yet part of the Swift language (version 5.0.1 at the time of this writing). It will be available with Swift 5.1. If you want to dive into its philosophy, please take a look at the <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0258-property-delegates.md">Swift Evolution Proposal SE-0258</a>.</p><p>My main goal here is not to make a deep and exhaustive review of the theory and implementation behind <strong>property wrappers</strong>, but to expose a concrete use case. A case presented during the WWDC in the talk ‚Äú<a href="https://developer.apple.com/videos/play/wwdc2019/721">Combine in practice</a>‚Äù involved @Published as a way to transform a traditional Swift property into a Combine <strong>Publisher</strong>. Although Apple introduced this property wrapper in the talk, it is not yet available in the first beta of Swift 5.1. This is the reason why I think it‚Äôs interesting to imagine the way Apple could have implemented it.</p><p>Before implementing @Published, we will see how property wrappers can be put to use.</p><h1>What is a property wrapper?</h1><p>Basically, a property wrapper is a generic data structure that encapsulates read/write access to a property while adding some extra behavior to ‚Äú<em>augment</em>‚Äù its semantics.</p><p>Let‚Äôs implement a very basic (and maybe simplistic?) example: what if we want to forbid Optionals we use in our program to be nil?</p><p>We will implement a <strong>property wrapper</strong> that forces this property to a default value when it mutates to a nil value:</p><img src="/Images/2019-06-18-PropertyWrappers/1.png"/><blockquote><p>This property wrapper encapsulates the access to the property: ‚Äúvar value: Value?‚Äù</p></blockquote><p>The Swift compiler will generate a <strong>@ConstrainedOptional</strong> annotation (named after the <strong>ConstrainedOptional</strong> property wrapper struct) that will apply the specified behavior to the annotated variable whenever it‚Äôs mutated.</p><img src="/Images/2019-06-18-PropertyWrappers/2.png"/><p>We can even add extra features to the property wrapper itself:</p><img src="/Images/2019-06-18-PropertyWrappers/3.png"/><p>We can then access the property wrapper dedicated features by prefixing the variable name with ‚Äú<strong>$</strong>‚Äù:</p><img src="/Images/2019-06-18-PropertyWrappers/4.png"/><p>In doing so, we can access the value of the counter without having to force unwrap it (there is not magic behind that of course, the force unwrapping is provided by the property wrapper).</p><h3>Using property wrapper to manage persistence</h3><p>As I mentioned earlier, the original name of property wrapper is <strong>property delegate</strong> <strong>(@propertyDelegate</strong> is still available in Xcode). This naming makes a lot of sense when it comes to inform a third party actor that a property has changed so it can execute some code.</p><p>Let‚Äôs say we want to read/write a value from/to a database each time a property is accessed/modified. A first approach could be to use a computed property like this:</p><img src="/Images/2019-06-18-PropertyWrappers/5.png"/><blockquote><p>CodableDAO is a tool that abstracts the storage of any value conforming to Codable</p></blockquote><p>What will soon be annoying is the need to write this for every property we want to persist with the CodableDAO.</p><p>Let‚Äôs encapsulate this inside a property wrapper:</p><img src="/Images/2019-06-18-PropertyWrappers/6.png"/><blockquote><p>Note that it is allowed to constrain the generic type of a property wrapper to conform to a protocol <strong>üëå</strong></p></blockquote><p>We can now annotate any Codable conforming property with <strong>@Persisted:</strong></p><img src="/Images/2019-06-18-PropertyWrappers/7.png"/><p>When mutated, the ‚Äú<strong>user</strong>‚Äù and ‚Äú<strong>country</strong>‚Äù properties will be persisted under the hood. The <strong>@Persisted</strong> property wrapper handles all the storage work for us üëç.</p><h4>Leveraging property wrapper to ease protocol conformance</h4><p>As we saw, property wrappers can be used to add additional behaviors or to change the underlying storage of a property.</p><p>We can bend it to fulfill another goal: make a type ‚Äú<em>almost</em>‚Äù conform to a protocol without having to make use of an extension.</p><p>Swift 5.1 introduced ‚Äú<strong>Identifiable</strong>‚Äù. It‚Äôs a protocol used in SwiftUI to uniquely identify rows in a List component. The only requirement for this protocol is to provide an ‚Äú<strong>id</strong>‚Äù property.</p><p>Let‚Äôs make String conform to this protocol in a traditional approach:</p><img src="/Images/2019-06-18-PropertyWrappers/8.png"/><p>Unfortunately, as extensions cannot have stored properties, the <strong>id</strong> value will be computed every time we access it.</p><img src="/Images/2019-06-18-PropertyWrappers/9.png"/><p>Two different ids for the very same value üò©. This is not the expected behavior for an Identifiable data.</p><p>Let a propery wrapper endorse the responsibility to be <strong><em>Identifiable</em></strong>:</p><img src="/Images/2019-06-18-PropertyWrappers/10.png"/><blockquote><p>Note the Identifiable conformance of UUIDIdentified</p></blockquote><p>As ‚Äú<strong>id</strong>‚Äù is a constant in the property wrapper, it does not change over time.</p><img src="/Images/2019-06-18-PropertyWrappers/11.png"/><p>Again, this is not necessarily what property wrappers are made for. They are made to act as a delegate for read/write access on a wrapped value, but I want to share this technique to get feedback from the community and to show that a property wrapper can itself conform to a protocol if needed.</p><h1>Implementing @Published</h1><p>We now have a solid understanding about property wrappers to make a reasonable guess about Apple‚Äôs implementation of <strong>@Published</strong>.</p><p>If you are not familiar with the concept of Publisher introduced with Combine, it is similar to what an Observable is in RxSwift for instance.</p><p>As stated in the talk <a href="https://developer.apple.com/videos/play/wwdc2019/721">Combine in practice</a>, annotating a property with @Published allows us to transform this property into a stream of its successive values. Basically, it will be used to make UIKit outlets compliant with Combine streams.</p><p>In the following ViewController, we listen for UITextField updates. For each one of these, we set the value of a String property named ‚Äúusername‚Äù annotated with @Published.</p><p>The @Published property wrapper makes <strong>$username</strong> be a Publisher that we can subscribe to.</p><img src="/Images/2019-06-18-PropertyWrappers/12.png"/><p>Here is my implementation of the @Published property wrapper. Every time the value is set, we also feed a Combine <strong>PassthroughSubject</strong> that can then be listened as a Publisher.</p><img src="/Images/2019-06-18-PropertyWrappers/13.png"/><blockquote><p><strong>Note there is a possible (and shorter) implementation with a CurrentValueSubject depending on the wish to always retrieve the current value when subscribing to it.</strong></p></blockquote><p>Since Publisher is a protocol, we can make the wrapper conform to it by forwarding the ‚Äú<strong>receive</strong>‚Äù function to the inner PassthroughSubject.</p><img src="/Images/2019-06-18-PropertyWrappers/14.png"/><p>That‚Äôs it. Any property annotated with @Published can also be seen as a Combine Publisher üëç.</p><h1>Conclusion</h1><p>Property wrappers are very powerful and can help reduce a great amount of boilerplate code. That‚Äôs a strength, but unfortunately also a danger.</p><p>Overusing it like this:</p><img src="/Images/2019-06-18-PropertyWrappers/15.png"/><p>could lead to the inability to understand the meaning of a program, the logic being spread in all the wrappers.</p><p>It reminds me of the kind of drawbacks a paradigm like <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming">Aspect Oriented Programming</a> can have. Somehow, property wrappers can be seen as <a href="https://en.wikipedia.org/wiki/Aspect_%28computer_programming%29">Aspects</a> in our code flow.</p><p>Time will tell us how to regulate their usage. Perhaps property wrappers should be restricted to Apple frameworks and Important third party APIs üßê.</p><p>Like custom operators, it can be a killer tool, but it can also blur the lines so much that you or your colleagues cannot understand your code anymore.</p><p>I look forward to how this will evolve in the next beta releases of Swift 5.1.</p><p>Stay tuned.</p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="/Images/avatar.png" alt="Thibault Wittemberg"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Thibault Wittemberg</p><p class="text-gray-600 text-xs md:text-base">Mobile Solution Architect in Montreal üá®üá¶ (thibault.wittemberg@gmail.com)</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2018-06-25-RxReduce-Part2" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2018-06-25-RxReduce-Part2/RxReduce_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, REACTIVE PROGRAMMING, OPEN SOURCE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxReduce: Reactive State Container Architecture Part 2</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">As we saw in ‚ÄúRxReduce: A Reactive State Container Architecture Part 1‚Äù, State is a central concern in applications. I strongly invite you to take a look at this first article. So far, we haven‚Äôt introduced the concept of Reactive Programming and how it can address some issues I‚Äôve encountered in traditional implementations of State Containers. We will see how RxReduce, an open source framework of the RxSwiftCommunity, can help you handle the State, its mutations, and the asynchronous work related to the side effects, in a Reactive way.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">11 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2017-12-22-RxFlow-Part3" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2017-12-22-RxFlow-Part3/RxFlow_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">OPEN SOURCE, REACTIVE PROGRAMMING</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxFlow Part 3: Tips and tricks</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">This is the final chapter of our journey within RxFlow. I‚Äôve already exposed all the key features/principles of the framework in these 2 previous parts, let‚Äôs dive into some tips and tricks I used thanks to Reactive Programming.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">7 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2018-06-24-RxReduce-Part1" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2018-06-24-RxReduce-Part1/RxReduceArchitecture.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, REACTIVE PROGRAMMING, OPEN SOURCE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxReduce: Reactive State Container Architecture Part 1</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">State management has become a very popular concern lately in mobile applications. The idea of a state that should be the single source of truth within an application is quite attractive ! The views would only be a displayable artefact of this state üëå.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">6 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Warp your mobile development</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>