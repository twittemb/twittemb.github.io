<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Warp your mobile development"/><link rel="canonical" href="http://blog.warpfactor.io/posts/2018-03-24-ElegantlyChainingUiviewpropertyAnimators"/><meta name="twitter:url" content="http://blog.warpfactor.io/posts/2018-03-24-ElegantlyChainingUiviewpropertyAnimators"/><meta name="og:url" content="http://blog.warpfactor.io/posts/2018-03-24-ElegantlyChainingUiviewpropertyAnimators"/><title>Elegantly chaining UIViewPropertyAnimators | Warp your mobile development</title><meta name="twitter:title" content="Elegantly chaining UIViewPropertyAnimators | Warp your mobile development"/><meta name="og:title" content="Elegantly chaining UIViewPropertyAnimators | Warp your mobile development"/><meta name="description" content="Usually my posts are mostly about design patterns, software architectures (or RxFlow üòÄ), but this time it will be different and frankly I didn't think I would write about this kind of topic. But I think I have something cool to share: so today we are going to talk about Animations with Swift."/><meta name="twitter:description" content="Usually my posts are mostly about design patterns, software architectures (or RxFlow üòÄ), but this time it will be different and frankly I didn't think I would write about this kind of topic. But I think I have something cool to share: so today we are going to talk about Animations with Swift."/><meta name="og:description" content="Usually my posts are mostly about design patterns, software architectures (or RxFlow üòÄ), but this time it will be different and frankly I didn't think I would write about this kind of topic. But I think I have something cool to share: so today we are going to talk about Animations with Swift."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Warp your mobile development"/></head><head>                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109460106-1"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'UA-109460106-1');
                </script></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üçè</span><span class="hidden md:block w-0 md:w-auto pl-1">Warp your mobile development</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/projects">PROJECTS</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/posts">MY POSTS</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">24 MARCH 2018<span class="text-gray-900 px-1">/</span><a href="/tags/uikit">UIKIT</a>, <a href="/tags/reactive-programming">REACTIVE PROGRAMMING</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">Elegantly chaining UIViewPropertyAnimators</h1></div><div class="container w-full max-w-6xl h-48 md:h-cover mx-auto bg-white bg-cover bg-center mt-8 sm:rounded" style="background-color: #465059; background-image:url('/Images/2018-03-24-ElegantlyChainingUiviewpropertyAnimators/Animator_blog.png');"></div><div class="container max-w-5xl mx-auto md:-mt-32"><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><p>Usually my posts are mostly about design patterns, software architectures (or RxFlow üòÄ), but this time it will be different and frankly I didn‚Äôt think I would write about this kind of topic. But I think I have something cool to share: so today we are going to talk about Animations with Swift.</p><p>I am not a UI/UX expert, so we are not going to dive into iOS animation frameworks, but lately I had a challenge to address at work. A colleague of mine came with this issue: ‚ÄúGuys, in our application we have some animations played in sequence and the way we do it is pretty ugly. Is there a better way ?‚Äù.</p><h1>UIView.animate()</h1><p>The ugliness he was referring to is the way we traditionally chain animations with UIKit. To illustrate my point, let‚Äôs consider this sequence:</p><img src="/Images/2018-03-24-ElegantlyChainingUiviewpropertyAnimators/animator-4.gif"/><p>Before iOS 10, one could have coded this sequence this way:</p><pre><code><div class="highlight"><span></span><span class="c1">/// on the &quot;Play animation&quot; click</span>

<span class="bp">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">box1</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">completed</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">completed</span> <span class="p">{</span>
        <span class="bp">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">box2</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                                    <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">completed</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="n">completed</span> <span class="p">{</span>
                <span class="bp">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
                    <span class="kc">self</span><span class="p">.</span><span class="n">box3</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                                            <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
                <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">completed</span><span class="p">)</span> <span class="k">in</span>
                    <span class="k">if</span> <span class="n">completed</span> <span class="p">{</span>
                        <span class="bp">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
                            <span class="kc">self</span><span class="p">.</span><span class="n">box1</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
                                                                    <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
                            <span class="kc">self</span><span class="p">.</span><span class="n">box3</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                    <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
                        <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">completed</span><span class="p">)</span> <span class="k">in</span>
                            <span class="k">if</span> <span class="n">completed</span> <span class="p">{</span>
                                <span class="bp">print</span> <span class="p">(</span><span class="s">&quot;Animations are over&quot;</span><span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>UIView.animate() provides a completion block we can use to trigger the next animation. Doing so, we can create a chain of animations. As you can see, the main drawback of this technic is the ugliness of the code. It is barely readable.</p><h1>UIViewPropertyAnimator</h1><p>Hopefully iOS 10 has introduced <strong>UIViewPropertyAnimator</strong>. I am not going to describe all the features it offers, there is a nice introduction here: <a href="https://useyourloaf.com/blog/quick-guide-to-property-animators/">useyourloaf</a>.</p><p>What I'm concerned about is how to improve the readability of the chaining mechanism. First thing first, UIViewPropertyAnimator natively enhance the completion technic.</p><p>The previous code snippet would become:</p><pre><code><div class="highlight"><span></span><span class="c1">/// initialize UIViewPropertyAnimator lazily</span>

<span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">animator1</span> <span class="p">=</span> <span class="p">{</span>
    <span class="bp">UIViewPropertyAnimator</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="p">.</span><span class="n">linear</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">box1</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}()</span>

<span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">animator2</span> <span class="p">=</span> <span class="p">{</span>
    <span class="bp">UIViewPropertyAnimator</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="p">.</span><span class="n">linear</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">box2</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}()</span>

<span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">animator3</span> <span class="p">=</span> <span class="p">{</span>
    <span class="bp">UIViewPropertyAnimator</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="p">.</span><span class="n">linear</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">box3</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}()</span>

<span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">animator4</span> <span class="p">=</span> <span class="p">{</span>
    <span class="bp">UIViewPropertyAnimator</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="p">.</span><span class="n">linear</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">box1</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">box3</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">translationX</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}()</span>

<span class="p">...</span>

<span class="c1">/// connect animations together</span>

<span class="kc">self</span><span class="p">.</span><span class="n">animator1</span><span class="p">.</span><span class="n">addCompletion</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">animator2</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>
<span class="p">}</span>

<span class="kc">self</span><span class="p">.</span><span class="n">animator2</span><span class="p">.</span><span class="n">addCompletion</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">animator3</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>
<span class="p">}</span>

<span class="kc">self</span><span class="p">.</span><span class="n">animator3</span><span class="p">.</span><span class="n">addCompletion</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">animator4</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="c1">/// on the &quot;Play animation&quot; click</span>

<span class="kc">self</span><span class="p">.</span><span class="n">animator1</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>
</div></code></pre><p>It allows to clearly separate the definition of each animation from the way they are connected together.</p><p>Not only have we a far better readability but also a better decoupling. We could imagine chaining animations differently according to some context. Pretty neat.</p><p>But there is one more thing ‚Ä¶</p><h1>Reactive animation chaining</h1><p>I am a big fan of Reactive programming and the first thing that came to my mind was: Is there a way to make <strong>UIViewPropertyAnimation</strong> RxSwift compliant ?</p><p>What do we want to be aware of in a Reactive way ? pretty easy: the end of an animation, so we can trigger the next one.</p><p>Traditionally with RxSwift, making something compliant with reactive programming consists of adding an extension to the Reactive struct. That sounds like a good start.</p><p>We have to figure out what kind of extension we need and what should be the return type of this extension ?</p><p>The extension will somehow have to wrap the "<strong>startAnimation</strong>" and "<strong>addCompletion</strong>" mechanisms of UIViewPropertyAnimator. It will have to return some kind of <strong>Observable</strong> as well. But for the sake of simplicity, we will assume that an animation can only "<strong>complete</strong>", there is no "<strong>stream</strong>" management (such as <strong>onNext</strong>, <strong>onSubscribed</strong>, <strong>onDisposed</strong> and so on). This assumption has a nice consequence on our implementation. Our Reactive extension won't return an <strong>Observable</strong> but a <strong>Completable</strong> which is a <strong>Trait</strong> that implies the Observable can only be <strong>Completed</strong> (or failed).</p><p>Without further ado, let's see this extension:</p><pre><code><div class="highlight"><span></span><span class="kd">extension</span> <span class="nc">Reactive</span> <span class="k">where</span> <span class="n">Base</span> <span class="p">==</span> <span class="bp">UIViewPropertyAnimator</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">animate</span><span class="p">:</span> <span class="n">Completable</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Completable</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">subscribe</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">completable</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Disposable</span> <span class="k">in</span>

            <span class="kc">self</span><span class="p">.</span><span class="n">base</span><span class="p">.</span><span class="n">addCompletion</span><span class="p">({</span> <span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">if</span> <span class="n">position</span> <span class="p">==</span> <span class="p">.</span><span class="n">end</span> <span class="p">{</span>
                    <span class="n">completable</span><span class="p">(.</span><span class="n">completed</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">})</span>

            <span class="kc">self</span><span class="p">.</span><span class="n">base</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">Disposables</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span>
                <span class="kc">self</span><span class="p">.</span><span class="n">base</span><span class="p">.</span><span class="n">stopAnimation</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="bp">UIViewPropertyAnimator</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">rx</span><span class="p">:</span> <span class="n">Reactive</span><span class="p">&lt;</span><span class="bp">UIViewPropertyAnimator</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Reactive</span><span class="p">&lt;</span><span class="bp">UIViewPropertyAnimator</span><span class="p">&gt;(</span><span class="kc">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>Basically the "<strong>animate</strong>" extension returns a <strong>Completable</strong> which, when being subscribed to, will start the animation and add a completion block that sends a "<strong>.</strong><strong>completed</strong>" event to the returned&nbsp;<strong>Completable</strong>.</p><p>The purpose is very simple: to be triggered when an animation is finished, so the next one can start.</p><p>The awesome thing with <strong>Completables</strong> is the ability to chain them with the very nice syntactic sugar expression "<strong>andThen</strong>".</p><p>Let's see that in action:</p><pre><code><div class="highlight"><span></span><span class="kc">self</span><span class="p">.</span><span class="n">animator1</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span>
    <span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">animator2</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span><span class="p">)</span>
    <span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">animator3</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span><span class="p">)</span>
    <span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">animator4</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span><span class="p">)</span>
    <span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>
    <span class="p">.</span><span class="n">disposed</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">disposeBag</span><span class="p">)</span>
</div></code></pre><p>It is very easy to read and is self explanatory. The animation sequence can even vary depending on some context, and the code structure is still very clear:</p><pre><code><div class="highlight"><span></span><span class="kd">var</span> <span class="nv">completable</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">animator1</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span>

<span class="k">if</span> <span class="n">shouldAnimateBox2</span> <span class="p">{</span>
    <span class="n">completable</span> <span class="p">=</span> <span class="n">completable</span><span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">animator2</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">completable</span><span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">animator3</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span><span class="p">)</span>
    <span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">animator4</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">animate</span><span class="p">)</span>
    <span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>
    <span class="p">.</span><span class="n">disposed</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">disposeBag</span><span class="p">)</span>
</div></code></pre><p>But wait, there is one <strong>last</strong> thing ‚Ä¶</p><h1>Magic animation chaining</h1><p>Although reactive chaining is quite satisfying, not everyone wants to rely on RxSwift to improve their code awesomeness !</p><p>Swift has a really cool feature to shorten complex statements while magnifying their expressivity: <strong>custom operators</strong>.</p><p>It takes some creativity to figure out the right way of doing this. So I asked myself what would be the most appropriate syntax for other developers to understand my code just by having a glance at it. I ended up with something like that :</p><pre><code><div class="highlight"><span></span><span class="n">animation1</span> <span class="o">~&gt;</span> <span class="n">animation2</span> <span class="o">~&gt;</span> <span class="n">animation3</span> <span class="o">~&gt;</span> <span class="n">animation4</span>
</div></code></pre><p>&nbsp;Could it be simpler ?</p><p>Let's do this:</p><pre><code><div class="highlight"><span></span><span class="kr">infix</span> <span class="kd">operator</span> <span class="o">~&gt;</span><span class="p">:</span> <span class="n">AdditionPrecedence</span>

<span class="p">@</span><span class="n">discardableResult</span>
<span class="kd">func</span> <span class="o">~&gt;</span><span class="p">(</span><span class="kr">left</span><span class="p">:</span> <span class="bp">UIViewPropertyAnimator</span><span class="p">,</span> <span class="kr">right</span><span class="p">:</span> <span class="bp">UIViewPropertyAnimator</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="bp">UIViewPropertyAnimator</span><span class="p">{</span>

    <span class="kr">left</span><span class="p">.</span><span class="n">addCompletion</span> <span class="p">{</span> <span class="p">(</span><span class="kc">_</span><span class="p">)</span> <span class="k">in</span>
        <span class="kr">right</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kr">right</span>
<span class="p">}</span>
</div></code></pre><p>What have we done here ?</p><ul><li>define a new binary operator: <strong>~&gt;</strong></li><li>define what is the behavior of this operator when applied to two UIViewPropertyAnimators</li></ul><p>This is just a way to connect two UIViewPropertyAnimators together and to hook the start of the second one to the end of the first one.</p><p>Using this new syntax couldn't be easier:</p><pre><code><div class="highlight"><span></span><span class="kc">self</span><span class="p">.</span><span class="n">animator1</span> <span class="o">~&gt;</span> <span class="kc">self</span><span class="p">.</span><span class="n">animator2</span> <span class="o">~&gt;</span> <span class="kc">self</span><span class="p">.</span><span class="n">animator3</span> <span class="o">~&gt;</span> <span class="kc">self</span><span class="p">.</span><span class="n">animator4</span>
<span class="kc">self</span><span class="p">.</span><span class="n">animator1</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">()</span>
</div></code></pre><p>I am always amazed by the effectiveness Swift can bring to our coding flow. I used to be a Java guy, and believe me, having such a concise syntax is a relief.</p><p>I hope it will give you new ideas to go even further into chaining animations with Swift.</p><p>Stay tuned.</p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="/Images/avatar.png" alt="Thibault Wittemberg"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Thibault Wittemberg</p><p class="text-gray-600 text-xs md:text-base">Mobile Solution Architect in Montreal üá®üá¶ (thibault.wittemberg@gmail.com)</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2017-12-22-RxFlow-Part3" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2017-12-22-RxFlow-Part3/RxFlow_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">OPEN SOURCE, REACTIVE PROGRAMMING</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxFlow Part 3: Tips and tricks</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">This is the final chapter of our journey within RxFlow. I‚Äôve already exposed all the key features/principles of the framework in these 2 previous parts, let‚Äôs dive into some tips and tricks I used thanks to Reactive Programming.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">8 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2021-02-13-StateMachineDSL" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2021-02-13-StateMachineDSL/header.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, OPEN SOURCE, LANGUAGE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">A DSL for state machines in Swift</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">State machines are great tools to describe systems with a finite number of states. They are predictable and testable, which is something we praise for as developers. State machines can be defined in a pretty abstract way, which makes it a good candidate for a Domain Specific Language implementation. In this article, we will try to create a DSL that can describe state machines in Swift and use it in a feedback loop architecture.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">15 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2019-07-20-Swift-AOP" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2019-07-20-Swift-AOP/puzzle.jpg" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">LANGUAGE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Swift: An Aspect Oriented Programming Language ?</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">To answer this question, we must first understand what is Aspect Oriented Programming (aka AOP). I like to see AOP as a response to a certain kind of failure of Object Oriented conceptions.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">13 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Warp your mobile development</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>