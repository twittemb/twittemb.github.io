<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Warp your mobile development"/><link rel="canonical" href="http://blog.warpfactor.io/posts/2017-12-09-RxFlow-Part2"/><meta name="twitter:url" content="http://blog.warpfactor.io/posts/2017-12-09-RxFlow-Part2"/><meta name="og:url" content="http://blog.warpfactor.io/posts/2017-12-09-RxFlow-Part2"/><title>RxFlow Part 2: In Practice | Warp your mobile development</title><meta name="twitter:title" content="RxFlow Part 2: In Practice | Warp your mobile development"/><meta name="og:title" content="RxFlow Part 2: In Practice | Warp your mobile development"/><meta name="description" content="A few weeks ago I introduced in this blog an iOS framework called RxFlow. I‚Äôve been working on this framework for several months, and it is now ready to be used. If you haven‚Äôt read it yet, I suggest you take a look at this post "RxFlow Part1: In Theory"."/><meta name="twitter:description" content="A few weeks ago I introduced in this blog an iOS framework called RxFlow. I‚Äôve been working on this framework for several months, and it is now ready to be used. If you haven‚Äôt read it yet, I suggest you take a look at this post "RxFlow Part1: In Theory"."/><meta name="og:description" content="A few weeks ago I introduced in this blog an iOS framework called RxFlow. I‚Äôve been working on this framework for several months, and it is now ready to be used. If you haven‚Äôt read it yet, I suggest you take a look at this post "RxFlow Part1: In Theory"."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Warp your mobile development"/></head><head>                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109460106-1"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'UA-109460106-1');
                </script></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üçè</span><span class="hidden md:block w-0 md:w-auto pl-1">Warp your mobile development</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/projects">PROJECTS</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/posts">MY POSTS</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">09 DECEMBER 2017<span class="text-gray-900 px-1">/</span><a href="/tags/open-source">OPEN SOURCE</a>, <a href="/tags/reactive-programming">REACTIVE PROGRAMMING</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">RxFlow Part 2: In Practice</h1></div><div class="container w-full max-w-6xl h-48 md:h-cover mx-auto bg-white bg-cover bg-center mt-8 sm:rounded" style="background-color: #465059; background-image:url('/Images/2017-12-09-RxFlow-Part2/RxFlow_Logo.png');"></div><div class="container max-w-5xl mx-auto md:-mt-32"><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><p>A few weeks ago I introduced in this blog an iOS framework called RxFlow. I‚Äôve been working on this framework for several months, and it is now ready to be used. If you haven‚Äôt read it yet, I suggest you take a look at this <a href="/posts/2017-11-08-RxFlow-Part1/">post</a>.</p><p>To sum up, RxFlow aims to:</p><ul><li>ease the cutting of your navigation into logical sections</li><li>remove the navigation code from the View Controllers</li><li>encourage the reusability of the View Controllers</li><li>promote reactive programming</li><li>promote dependency injection</li></ul><p>A quick reminder of the terminology:</p><ul><li>Flow: each Flow defines a navigation area within your application.</li><li>Step: each Step is a navigation state in your application. Combinaisons of Flows and Steps describe all the possible navigation actions.</li><li>Stepper: it can be anything that can emit Steps. Steppers will be responsible for triggering every navigation actions within the Flows</li><li>Presentable: it is an abstraction of something that can be presented, basically UIViewController and Flow are Presentable</li><li>NextFlowItem: it tells the Coordinator what will be the next thing that will produce new Steps in its Reactive mechanism</li><li>Coordinator: the job of the Coordinator is to mix combinaisons of Flows and Steps in a consistent way</li></ul><p>It is also important to keep in mind that RxFlow uses protocol oriented programming so that it doesn‚Äôt freeze your code in an inheritance hierarchy.</p><p>In the <a href="https://github.com/RxSwiftCommunity/RxFlow">RxFlow repo</a> you will find a demo application. It shows pretty much every possible navigation types:</p><ul><li>Navigation stack</li><li>Tab bar</li><li>Master / detail</li><li>Modal popup</li></ul><img src="/Images/2017-12-09-RxFlow-Part2/demo_rxflow.gif"/><h1>It‚Äôs all about States</h1><p>RxFlow is mainly about handling navigation state changes in a reactive way. In order to be reused in multiple contexts, these states must be unaware of the current navigation Flow the user is in. Therefore, instead of meaning ‚ÄúI want to go to this screen‚Äù, a state will rather mean ‚ÄúSomeone or something has done this action‚Äù and RxFlow will pick the right screen according to the current navigation Flow. With RxFlow, this navigation states are called Steps.</p><p>Enums are a great way to describe Steps:</p><ul><li>they are easy to use</li><li>a value can be defined only one time (therefore a state is unique)</li><li>they are safe to use as Swift wants you to implement all their possible values in switch statements</li><li>they can embed values that will be given from one screen to another</li><li>they are value types, so there is no shared reference with uncontrolled propagation</li></ul><p>For instance, in the demo application, those are all the Steps that we need to cover the navigations possibilities.</p><pre><code><div class="highlight"><span></span><span class="kd">import</span> <span class="nc">RxFlow</span>

<span class="kd">enum</span> <span class="nc">DemoStep</span><span class="p">:</span> <span class="n">Step</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">apiKey</span>
    <span class="k">case</span> <span class="n">apiKeyIsComplete</span>

    <span class="k">case</span> <span class="n">movieList</span>

    <span class="k">case</span> <span class="n">moviePicked</span> <span class="p">(</span><span class="n">withMovieId</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">castPicked</span> <span class="p">(</span><span class="n">withCastId</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span>

    <span class="k">case</span> <span class="n">settings</span>
    <span class="k">case</span> <span class="n">settingsDone</span>
    <span class="k">case</span> <span class="n">about</span>
<span class="p">}</span>
</div></code></pre><h1>Go with the Flow</h1><p>With RxFlow, all the navigation code, such as presenting or pushing view controllers, is declared in Flows. A Flow represents a logical navigation section in your application, and when combined to a specific Step, it triggers some navigation actions.</p><p>To do so, a Flow has to implement:</p><ul><li>a ‚Äúnavigate(to:)‚Äù function that makes the navigation actions happen according the Flow and the Step</li><li>a ‚Äúroot‚Äù UIViewController on which will be based the navigation in this Flow</li></ul><p>Here is a Flow example that handles a UINavigationController and its navigation stack. In this Flow, three navigation actions are possible.</p><pre><code><div class="highlight"><span></span><span class="kd">import</span> <span class="nc">RxFlow</span>
<span class="kd">import</span> <span class="nc">UIKit</span>

<span class="kd">class</span> <span class="nc">WatchedFlow</span><span class="p">:</span> <span class="n">Flow</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">root</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">rootViewController</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">rootViewController</span> <span class="p">=</span> <span class="bp">UINavigationController</span><span class="p">()</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">service</span><span class="p">:</span> <span class="n">MoviesService</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">withService</span> <span class="n">service</span><span class="p">:</span> <span class="n">MoviesService</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">service</span> <span class="p">=</span> <span class="n">service</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">navigate</span><span class="p">(</span><span class="n">to</span> <span class="n">step</span><span class="p">:</span> <span class="n">Step</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">step</span> <span class="p">=</span> <span class="n">step</span> <span class="k">as</span><span class="p">?</span> <span class="n">DemoStep</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">NextFlowItem</span><span class="p">.</span><span class="n">noNavigation</span>
        <span class="p">}</span>

        <span class="k">switch</span> <span class="n">step</span> <span class="p">{</span>

        <span class="k">case</span> <span class="p">.</span><span class="n">movieList</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">navigateToMovieListScreen</span><span class="p">()</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">moviePicked</span><span class="p">(</span><span class="kd">let</span> <span class="nv">movieId</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">navigateToMovieDetailScreen</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">movieId</span><span class="p">)</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">castPicked</span><span class="p">(</span><span class="kd">let</span> <span class="nv">castId</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">navigateToCastDetailScreen</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">castId</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NextFlowItem</span><span class="p">.</span><span class="n">noNavigation</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">navigateToMovieListScreen</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">]</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">viewModel</span> <span class="p">=</span> <span class="n">WatchedViewModel</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">service</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">viewController</span> <span class="p">=</span> <span class="n">WatchedViewController</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)</span>
        <span class="n">viewController</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&quot;Watched&quot;</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">(</span><span class="n">nextPresentable</span><span class="p">:</span> <span class="n">viewController</span><span class="p">,</span> <span class="n">nextStepper</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)]</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">navigateToMovieDetailScreen</span> <span class="p">(</span><span class="n">with</span> <span class="n">movieId</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">]</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">viewModel</span> <span class="p">=</span> <span class="n">MovieDetailViewModel</span><span class="p">(</span><span class="n">withService</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">service</span><span class="p">,</span> <span class="n">andMovieId</span><span class="p">:</span> <span class="n">movieId</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">viewController</span> <span class="p">=</span> <span class="n">MovieDetailViewController</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)</span>
        <span class="n">viewController</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">title</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">(</span><span class="n">nextPresentable</span><span class="p">:</span> <span class="n">viewController</span><span class="p">,</span> <span class="n">nextStepper</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)]</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">navigateToCastDetailScreen</span> <span class="p">(</span><span class="n">with</span> <span class="n">castId</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">]</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">viewModel</span> <span class="p">=</span> <span class="n">CastDetailViewModel</span><span class="p">(</span><span class="n">withService</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">service</span><span class="p">,</span> <span class="n">andCastId</span><span class="p">:</span> <span class="n">castId</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">viewController</span> <span class="p">=</span> <span class="n">CastDetailViewController</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)</span>
        <span class="n">viewController</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">name</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NextFlowItem</span><span class="p">.</span><span class="n">noNavigation</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><h1>Navigation is a side effect</h1><p>When we learn Functional Reactive Programming, we often read about side effects. The aim of FRP is to propagate events and apply them functions all along the way. These functions may transform those events and eventually (but not necessarily) execute code that will perform whatever feature you want (do some networking, save a file, display an alert, ‚Ä¶): those are side effects.</p><p>Because RxFlow relies on Reactive Programming, we can easily identify the inherent notions:</p><ul><li>events: those are the emitted Steps</li><li>function: this is the ‚Äúnavigate(to:)‚Äù function</li><li>transformation: the ‚Äúnavigate(to:)‚Äù function transforms a <strong> Step</strong> into NextFlowItem</li><li>side effects: those are the navigation actions performed in ‚Äúnavigate(to:)‚Äù (for instance, the function ‚ÄúnavigateToMovieListScreen()‚Äù pushes a new UIViewController on the navigation stack)</li></ul><h1>Navigating consists in making NextFlowItems</h1><p>Basically, a NextFlowItem is a simple data structure that holds a Presentable and a Stepper.</p><p>A Presentable tells the Coordinator what will be the next thing you will present, and a Stepper tells the Coordinator what will be the next thing to emit Steps.</p><p>By default, all kinds of UIViewControllers are Presentable. Flows are also Presentable because at some point you will want to launch a whole new navigation area described in its own Flow, so RxFlow consider it as something that can be presented.</p><p>Why should the Coordinator know about Presentables ?</p><p>Presentable is an abstraction of something that can be presented. Because a Step cannot be emitted unless its associated Presentable is displayed, Presentable offers Reactive observables that the Coordinator will subscribe to (so it will be aware of the presentation state of the Presentable). Therefore there is no risk of firing a Step while its Presentable is not yet fully displayed.</p><p>A Stepper can be anything: a custom UIViewController, a ViewModel, a Presenter‚Ä¶ Once it is registered in the Coordinator, a Stepper can emits Steps via its ‚Äústep‚Äù property (which is a RxSwift subject). The Coordinator will listen for these Steps and call the Flow‚Äôs ‚Äúnavigate(to:)‚Äù function.</p><p>Here is an exemple of Stepper in the demo app.</p><pre><code><div class="highlight"><span></span><span class="kd">import</span> <span class="nc">RxFlow</span>
<span class="kd">import</span> <span class="nc">RxSwift</span>

<span class="kd">class</span> <span class="nc">WatchedViewModel</span><span class="p">:</span> <span class="n">Stepper</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nv">movies</span><span class="p">:</span> <span class="p">[</span><span class="n">MovieViewModel</span><span class="p">]</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">with</span> <span class="n">service</span><span class="p">:</span> <span class="n">MoviesService</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// we can do some data refactoring in order to display</span>
        <span class="c1">// things exactly the way we want (this is the aim of a ViewModel)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">movies</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">watchedMovies</span><span class="p">().</span><span class="bp">map</span><span class="p">({</span> <span class="p">(</span><span class="n">movie</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MovieViewModel</span> <span class="k">in</span>
            <span class="k">return</span> <span class="n">MovieViewModel</span><span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="n">movie</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="n">title</span><span class="p">:</span> <span class="n">movie</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
                                  <span class="n">image</span><span class="p">:</span> <span class="n">movie</span><span class="p">.</span><span class="n">image</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">pick</span> <span class="p">(</span><span class="n">movieId</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">step</span><span class="p">.</span><span class="n">onNext</span><span class="p">(</span><span class="n">DemoStep</span><span class="p">.</span><span class="n">moviePicked</span><span class="p">(</span><span class="n">withMovieId</span><span class="p">:</span> <span class="n">movieId</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>In this example, the pick function is called when the user picks a movie in a list. This function emits a new value in the ‚Äúself.step‚Äù Rx stream.</p><p>To sum up the navigation process :</p><ul><li>the navigate(to:) function is called with a Step as a parameter</li><li>according to this Step, some navigation code is called (side effects)</li><li>also according to this Step, NextFlowItems are produced. Therefore, Presentables and Steppers are registered into the Coordinator</li><li>Steppers emit new Steps and here we go again</li></ul><h1>Why is it OK to produce multiple NextFlowItems for a single combination of Flow and Step ?</h1><p>Because nothing forbids an application to have several navigations at a time. For instance each item of a tab bar can lead to a navigation stack. The Step that triggers the display of the UITabbarController will result in a NextFlowItem per navigation stack.</p><p>You can have a look at the demo app to understand the concept. Here is an extract where we wire a UITabBarController with 2 Flows (each Flow describes the navigation stack associated with a tab bar item):</p><pre><code><div class="highlight"><span></span><span class="kd">private</span> <span class="kd">func</span> <span class="nf">navigationToDashboardScreen</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">]</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">tabbarController</span> <span class="p">=</span> <span class="bp">UITabBarController</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nv">wishlistStepper</span> <span class="p">=</span> <span class="n">WishlistStepper</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nv">wishListFlow</span> <span class="p">=</span> <span class="n">WishlistWarp</span><span class="p">(</span><span class="n">withService</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">service</span><span class="p">,</span>
                                    <span class="n">andStepper</span><span class="p">:</span> <span class="n">wishlistStepper</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nv">watchedFlow</span> <span class="p">=</span> <span class="n">WatchedFlow</span><span class="p">(</span><span class="n">withService</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">service</span><span class="p">)</span>

    <span class="n">Flows</span><span class="p">.</span><span class="n">whenReady</span><span class="p">(</span><span class="n">flow1</span><span class="p">:</span> <span class="n">wishListFlow</span><span class="p">,</span> <span class="n">flow2</span><span class="p">:</span> <span class="n">watchedFlow</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="kc">self</span><span class="p">]</span>
    <span class="p">(</span><span class="n">root1</span><span class="p">:</span> <span class="bp">UINavigationController</span><span class="p">,</span> <span class="n">root2</span><span class="p">:</span> <span class="bp">UINavigationController</span><span class="p">)</span> <span class="k">in</span>
        <span class="kd">let</span> <span class="nv">tabBarItem1</span> <span class="p">=</span> <span class="bp">UITabBarItem</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&quot;Wishlist&quot;</span><span class="p">,</span>
                                       <span class="n">image</span><span class="p">:</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&quot;wishlist&quot;</span><span class="p">),</span>
                                       <span class="n">selectedImage</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">tabBarItem2</span> <span class="p">=</span> <span class="bp">UITabBarItem</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&quot;Watched&quot;</span><span class="p">,</span>
                                       <span class="n">image</span><span class="p">:</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&quot;watched&quot;</span><span class="p">),</span>
                                       <span class="n">selectedImage</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="n">root1</span><span class="p">.</span><span class="n">tabBarItem</span> <span class="p">=</span> <span class="n">tabBarItem1</span>
        <span class="n">root1</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&quot;Wishlist&quot;</span>
        <span class="n">root2</span><span class="p">.</span><span class="n">tabBarItem</span> <span class="p">=</span> <span class="n">tabBarItem2</span>
        <span class="n">root2</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&quot;Watched&quot;</span>

        <span class="n">tabbarController</span><span class="p">.</span><span class="n">setViewControllers</span><span class="p">([</span><span class="n">root1</span><span class="p">,</span> <span class="n">root2</span><span class="p">],</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">tabbarController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="p">([</span><span class="n">NextFlowItem</span><span class="p">(</span><span class="n">nextPresentable</span><span class="p">:</span> <span class="n">wishListFlow</span><span class="p">,</span>
                      <span class="n">nextStepper</span><span class="p">:</span> <span class="n">wishlistStepper</span><span class="p">),</span>
             <span class="n">NextFlowItem</span><span class="p">(</span><span class="n">nextPresentable</span><span class="p">:</span> <span class="n">watchedFlow</span><span class="p">,</span>
                      <span class="n">nextStepper</span><span class="p">:</span> <span class="n">OneStepper</span><span class="p">(</span><span class="n">withSingleStep</span><span class="p">:</span> <span class="n">DemoStep</span><span class="p">.</span><span class="n">movieList</span><span class="p">))])</span>
<span class="p">}</span>
</div></code></pre><p>The static function ‚ÄúFlows.whenReady()‚Äù takes the Flows to launch and a closure that will be called when these Flows are ready to be displayed (ie when the first screen of this Flow has been picked).</p><h1>Why is it OK to produce no NextFlowItem at all for a combination of Flow and Step ?</h1><p>Because a navigation Flow has to have an end ! For instance the last screen of a navigation stack will not allow further navigation but only a back action handled by the UINavigationController itself. In this case, the navigate(to:) function will return NextFlowItem.noNavigation.</p><h1>What happens in a Flow ‚Ä¶ stays in a Flow !</h1><p>As we‚Äôve already seen, it is possible to have multiple Flows being navigated at the same time. For instance, a screen in a navigation stack could launch a popup which could also contain another navigation stack. From a UIKit point of view, the UIViewController hierarchy is very important, and we cannot mess up with that inside the Coordinator.</p><p>This is why when a Flow is not currently displayed (in our example, it is when the first navigation stack is under the popup), the Steps that could be emitted within it will be ignored by the Coordinator.</p><p>In a more general point of view, the Steps emitted in the context of a Flow will be interpreted only in the context of that Flow(they cannot be caught by other ones).</p><h1>Dependency Injection made easy</h1><p>DI is one of the main goal of RxFlow. Basically, dependency injection can be done by passing an implementation of something (a service, a manager, ‚Ä¶) as a parameter to an initializer or a method (it can also be done via property).</p><p>In a RxFlow, as the developer takes care of instantiating UIViewControllers, ViewModels, Presenters, and so on, it is a great opportunity to inject whatever you need. Here is an example of dependency injection in a ViewModel.</p><pre><code><div class="highlight"><span></span><span class="kd">import</span> <span class="nc">RxFlow</span>
<span class="kd">import</span> <span class="nc">UIKit</span>

<span class="kd">class</span> <span class="nc">WatchedFlow</span><span class="p">:</span> <span class="n">Flow</span> <span class="p">{</span>

    <span class="p">...</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">service</span><span class="p">:</span> <span class="n">MoviesService</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">withService</span> <span class="n">service</span><span class="p">:</span> <span class="n">MoviesService</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">service</span> <span class="p">=</span> <span class="n">service</span>
    <span class="p">}</span>
    <span class="p">...</span>
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">navigateToMovieListScreen</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">]</span> <span class="p">{</span>
        <span class="c1">// inject Service into ViewModel</span>
        <span class="kd">let</span> <span class="nv">viewModel</span> <span class="p">=</span> <span class="n">WatchedViewModel</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">service</span><span class="p">)</span>

        <span class="c1">// injecy ViewMNodel into UIViewController</span>
        <span class="kd">let</span> <span class="nv">viewController</span> <span class="p">=</span> <span class="n">WatchedViewController</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)</span>

        <span class="n">viewController</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&quot;Watched&quot;</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">pushViewController</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NextFlowItem</span><span class="p">(</span><span class="n">nextPresentable</span><span class="p">:</span> <span class="n">viewController</span><span class="p">,</span> <span class="n">nextStepper</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">)]</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</div></code></pre><h1>How to bootstrap a navigation process</h1><p>Now that you know how to wire things together, to mix Flows and Steps to trigger navigation actions and to produce NextFlowItems, there is one thing left to do: bootstrap the navigation process when the application starts.</p><p>Everything happens in the AppDelegate, and you‚Äôll see that this is pretty straightforward:</p><ul><li>instantiate the Coordinator</li><li>instantiate the first Flow to be navigated</li><li>ask the Coordinator to coordinate this Flow with a first Step</li><li>when the first Flow is ready, set its root as the rootViewController of the Window</li></ul><p>Here is how it is done in the demo app.</p><pre><code><div class="highlight"><span></span><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">RxFlow</span>
<span class="kd">import</span> <span class="nc">RxSwift</span>
<span class="kd">import</span> <span class="nc">RxCocoa</span>

<span class="kr">@UIApplicationMain</span>
<span class="kd">class</span> <span class="nc">AppDelegate</span><span class="p">:</span> <span class="bp">UIResponder</span><span class="p">,</span> <span class="bp">UIApplicationDelegate</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nv">disposeBag</span> <span class="p">=</span> <span class="n">DisposeBag</span><span class="p">()</span>
    <span class="kd">var</span> <span class="nv">window</span><span class="p">:</span> <span class="bp">UIWindow</span><span class="p">?</span>
    <span class="kd">var</span> <span class="nv">coordinator</span> <span class="p">=</span> <span class="n">Coordinator</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nv">movieService</span> <span class="p">=</span> <span class="n">MoviesService</span><span class="p">()</span>
    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">mainFlow</span> <span class="p">=</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">MainFlow</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">movieService</span><span class="p">)</span>
    <span class="p">}()</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="kc">_</span> <span class="n">application</span><span class="p">:</span> <span class="bp">UIApplication</span><span class="p">,</span>
                     <span class="n">didFinishWithOptions</span> <span class="n">options</span><span class="p">:</span> <span class="p">[</span><span class="n">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]?)</span>
                     <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>

        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">window</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">window</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>

        <span class="n">Flows</span><span class="p">.</span><span class="n">whenReady</span><span class="p">(</span><span class="n">flow</span><span class="p">:</span> <span class="n">mainFlow</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kr">unowned</span> <span class="n">window</span><span class="p">]</span> <span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span> <span class="p">=</span> <span class="n">root</span>
        <span class="p">})</span>

        <span class="n">coordinator</span><span class="p">.</span><span class="n">coordinate</span><span class="p">(</span><span class="n">flow</span><span class="p">:</span> <span class="n">mainFlow</span><span class="p">,</span>
                               <span class="n">withStepper</span><span class="p">:</span> <span class="n">OneStepper</span><span class="p">(</span><span class="n">withSingleStep</span><span class="p">:</span> <span class="n">DemoStep</span><span class="p">.</span><span class="n">apiKey</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><h1>Bonus</h1><p>There are two reactive extensions to the Coordinator: willNavigate and didNavigate. You can subscribe to them in the AppDelegate for instance.</p><pre><code><div class="highlight"><span></span><span class="n">coordinator</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">didNavigate</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span> <span class="k">in</span>
    <span class="bp">print</span> <span class="p">(</span><span class="s">&quot;did navigate to flow=</span><span class="si">\(</span><span class="n">flow</span><span class="si">)</span><span class="s"> and step=</span><span class="si">\(</span><span class="n">step</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}).</span><span class="n">disposed</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">disposeBag</span><span class="p">)</span>
</div></code></pre><p>This will produce this kind of logs:</p><pre><code><div class="highlight"><span></span><span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">MainFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">apiKeyIsComplete</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WishlistFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">movieList</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WatchedFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">movieList</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WishlistFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">moviePicked</span><span class="p">(</span><span class="mi">23452</span><span class="p">)</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WishlistFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">castPicked</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WatchedFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">moviePicked</span><span class="p">(</span><span class="mi">55423</span><span class="p">)</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WatchedFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">castPicked</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">WishlistFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">settings</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">SettingsFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">settings</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">SettingsFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">apiKey</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">SettingsFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">about</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">SettingsFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">apiKey</span>
<span class="n">did</span> <span class="n">navigate</span> <span class="n">flow</span><span class="p">=</span><span class="n">RxFlowDemo</span><span class="p">.</span><span class="n">SettingsFlow</span> <span class="n">step</span><span class="p">=</span><span class="n">settingsDone</span>
</div></code></pre><p>It can be very helpful for analytics and debug purposes.</p><p>I hope you will find this Reactive Flow Coordinator pattern interesting and useful. Please, feel free to contribute and challenge my work: <a href="https://github.com/RxSwiftCommunity/RxFlow">RxFlow on GitHub</a>.</p><p>The third and last post about RxFlow will be about the tips and tricks I used to implement all the reactive mechanisms.</p><p>Stay tuned.</p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="/Images/avatar.png" alt="Thibault Wittemberg"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Thibault Wittemberg</p><p class="text-gray-600 text-xs md:text-base">Mobile Solution Architect in Montreal üá®üá¶ (thibault.wittemberg@gmail.com)</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2018-04-28-TypeSafeNetworkLayer" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2018-04-28-TypeSafeNetworkLayer/network_layer.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Type safe network layer</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">There are plenty of posts about doing a network layer in a type safe way with Swift. No matter the used network API, those approaches all rely on returning a data type that is precisely what we expect. In this post we will try to go a little bit further by strongly coupling the endpoint we want to fetch and the data type we are expecting.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">5 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2021-02-13-StateMachineDSL" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2021-02-13-StateMachineDSL/header.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, OPEN SOURCE, LANGUAGE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">A DSL for state machines in Swift</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">State machines are great tools to describe systems with a finite number of states. They are predictable and testable, which is something we praise for as developers. State machines can be defined in a pretty abstract way, which makes it a good candidate for a Domain Specific Language implementation. In this article, we will try to create a DSL that can describe state machines in Swift and use it in a feedback loop architecture.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">14 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2017-11-01-EZStream" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2017-11-01-EZStream/ezstream-header.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">OPEN SOURCE, APPLICATION</p><div class="w-full font-bold text-2xl text-gray-900 px-6">EZStream</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">EZStream is the easiest way to stream your device camera in any web browser.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">1 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Warp your mobile development</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>