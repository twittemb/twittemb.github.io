<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Warp your mobile development"/><link rel="canonical" href="http://blog.warpfactor.io/posts/2018-06-24-RxReduce-Part1"/><meta name="twitter:url" content="http://blog.warpfactor.io/posts/2018-06-24-RxReduce-Part1"/><meta name="og:url" content="http://blog.warpfactor.io/posts/2018-06-24-RxReduce-Part1"/><title>RxReduce: Reactive State Container Architecture Part 1 | Warp your mobile development</title><meta name="twitter:title" content="RxReduce: Reactive State Container Architecture Part 1 | Warp your mobile development"/><meta name="og:title" content="RxReduce: Reactive State Container Architecture Part 1 | Warp your mobile development"/><meta name="description" content="State management has become a very popular concern lately in mobile applications. The idea of a state that should be the single source of truth within an application is quite attractive ! The views would only be a displayable artefact of this state üëå."/><meta name="twitter:description" content="State management has become a very popular concern lately in mobile applications. The idea of a state that should be the single source of truth within an application is quite attractive ! The views would only be a displayable artefact of this state üëå."/><meta name="og:description" content="State management has become a very popular concern lately in mobile applications. The idea of a state that should be the single source of truth within an application is quite attractive ! The views would only be a displayable artefact of this state üëå."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Warp your mobile development"/></head><head>                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109460106-1"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'UA-109460106-1');
                </script></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üçé</span><span class="hidden md:block w-0 md:w-auto pl-1">Warp your mobile development</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/projects">PROJECTS</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/posts">MY POSTS</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">24 JUNE 2018<span class="text-gray-900 px-1">/</span><a href="/tags/architecture">ARCHITECTURE</a>, <a href="/tags/reactive-programming">REACTIVE PROGRAMMING</a>, <a href="/tags/open-source">OPEN SOURCE</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">RxReduce: Reactive State Container Architecture Part 1</h1></div><div class="container w-full max-w-6xl h-48 md:h-cover mx-auto bg-white bg-cover bg-center mt-8 sm:rounded" style="background-color: #465059; background-image:url('/Images/2018-06-24-RxReduce-Part1/RxReduceArchitecture.png');"></div><div class="container max-w-5xl mx-auto md:-mt-32"><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><p>State management has become a very popular concern lately in mobile applications. The idea of a state that should be the single source of truth within an application is quite attractive ! The views would only be a displayable artefact of this state üëå.</p><p>But as you all know, with great powers comes great responsibility ‚Ä¶ and a bunch of questions üòÄ :</p><ul><li>What the hell is a state ?</li><li>How do I build my application around a state ?</li><li>Is there a pattern or an architecture that ease the state management ?</li><li>How do I leverage Swift's type safety and value types in order to elegantly manage state mutation ?</li></ul><p>That's a lot to cover, but let's not be afraid because this is pretty straightforward in the end.</p><p>This is a two parts article. In the first part I will try to guide you through the wonderful land of State and State immutability. <a href="/posts/2018-06-25-RxReduce-Part2">In the second part</a>, I will introduce RxReduce, a framework I've opensourced that implement a <strong>Reactive State Container Architecture</strong>.</p><h1>What is a State ?</h1><p>State is a notion that we find in a lot of domains: classical mechanics, quantum mechanics, thermodynamics, physics, politics, computer science, software engineering‚Ä¶</p><p>A few definitions from Wikipedia:</p><blockquote><p>For thermodynamics, a state of a system is its condition at a specific time, that is fully identified by values of a suitable set of parameters known as state variables, state parameters or thermodynamic variables.</p></blockquote><blockquote><p><em>In information technology and computer science, a program is described as stateful if it is designed to remember preceding events or user interactions; the remembered information is called the state of the system.</em></p></blockquote><blockquote><p>In physics, a state of matter is one of the distinct forms in which matter can exist. Four states of matter are observable in everyday life: solid, liquid, gas, and plasma.</p></blockquote><p>No matter the field of knowledge, a state is defined by :</p><ul><li>some intrinsic properties &nbsp;(shape, color, weight, ‚Ä¶)</li><li>the values of those properties at a give time</li><li>the condition of its existence and the rules that drive its mutation</li></ul><p>If we refer to computer science, we all learned how a state machine works. I find its definition pretty great and it brings some very good insights about what's coming next in this post:</p><blockquote><p>It is an abstract machine that can be in exactly one of a finite number of states at any given time. The state machine can change from one state to another in response to some external inputs. The change from one state to another is called a transition. An state machine is defined by a list of its states, its initial state, and the conditions for each transition.</p></blockquote><p>Guess what ? An application is a state machine:</p><ul><li>a state for an application is the agregat of: its screens layouts, the navigation between those screens, the data it displays, the sounds it can emit, ‚Ä¶</li><li>it has a finite number of possible states&nbsp;</li><li>it can only be in one state at a time depending on user inputs, runtime environment, physical device, external data, ‚Ä¶</li><li>according to external inputs (user, network, ‚Ä¶), an application will go from a state to another (navigation between screens, view update, ‚Ä¶): these are state transitions.</li></ul><p><strong>State is the heart of your application, by definition !</strong></p><p>If <strong>State</strong>&nbsp;is correctly handled, you are on a good path to have a safe, bug free application.</p><h1>State Container Architectures</h1><p>Mastering the notion of state is only the first half of the way üòÄ. The challenge is to handle it well. This is where "<strong>State Container Architectures</strong>" come into play.</p><p>State Container Architectures are not a brand new idea, they all rely on well known concepts such as value types, immutability, functional programming and unidirectional data flow. <strong>Redux</strong> is a famous implementation of this kind of architecture.</p><p>Before going further, I strongly encourage you to read these 2 great articles about state container and unidirectional data flow architectures:</p><ul><li><a href="https://jobandtalent.engineering/ios-architecture-an-state-container-based-approach-4f1a9b00b82e">iOS Architecture: A State Container based approach</a></li><li><a href="https://academy.realm.io/posts/benji-encz-unidirectional-data-flow-swift/">Unidirectional Data Flow: Shrinking Massive View Controllers</a></li></ul><h2>A picture worth a thousand words</h2><p>The only purpose of a <strong>State Container Architecture</strong> is to provide a safe way to mutate and expose the state within your application. Here is the flow of such a pattern:</p><img src="/Images/2018-06-24-RxReduce-Part1/rxreducescheme.gif"/><p>The first thing to notice here is the unidirectional aspect of the flow: you can imagine a loop of events coming from and going back to the view and producing a new version of the state at each iteration. This is our state transitions from the previous state machine definition.&nbsp;</p><h2>A glance at each concept of this pattern</h2><ul><li>The&nbsp;<strong>Store</strong>&nbsp;is the component that handles your <strong>State</strong>. It has only one input: a "<strong>dispatch()</strong>" function, that takes an&nbsp;<strong>Action</strong>&nbsp;as a parameter.</li><li>The <strong>State</strong> must be immutable by definition. The only way to trigger a&nbsp;<strong>State</strong>&nbsp;mutation is to call the <strong>Store</strong>'s "<strong>dispatch()</strong>" function with an <strong>Action</strong>, it will create a new <strong>State</strong>.</li><li><strong>Actions</strong>&nbsp;are simple types with no business logic (structs for instance). They embed the payload needed to mutate the <strong>State</strong> (ids, search strings, ‚Ä¶).&nbsp;</li><li>Only pure and testable functions called&nbsp;<strong>Reducers</strong> can mutate a&nbsp;<strong>State</strong>. A "<strong>reduce()</strong>" function takes a&nbsp;<strong>State</strong>, an&nbsp;<strong>Action</strong>&nbsp;and returns the new&nbsp;<strong>State</strong>&nbsp;‚Ä¶ that simple (this is the <strong>State</strong> transition).</li><li>You can have as many <strong>Reducers</strong> as you want, they will be applied by the&nbsp;<strong>Store</strong>'s "<strong>dispatch()</strong>" function sequentially. It could be nice to have a <strong>R</strong><strong>educer</strong> per business concern for instance.</li><li><strong>Reducers</strong>&nbsp;cannot perform asynchronous logic, they can only mutate the <strong>State</strong> in a synchronous and testable way. Asynchronous work, being side effects, will be taken care of by other mechanisms (we will see that in the second part of this article).</li><li>The <strong>Store</strong> exposes some kind of <strong>State</strong> observable so that your views can be notified each time a new <strong>State</strong> is calculated.</li></ul><h1>Why is this a nice pattern ?</h1><p>As we saw earlier: "<strong>State is the heart of your application, by definition !"</strong>. Having a reproductible, safe, state centric pattern brings some nice garanties:</p><ul><li>No uncontrolled propagation for the <strong>State</strong> modifications. As it is a value type, each mutation creates a new copy of the <strong>State</strong>. It is not a shared reference type which mutations could lead to inconsistency all across the application.</li><li><strong>State</strong> mutation is very strictly framed by <strong>Actions</strong> dispatching. This provides a very safe environment to onboard new players in your development team.&nbsp;</li><li>Race conditions are avoided thanks to <strong>State</strong> being a value type and asynchronous works being very segregated.</li><li>Application global <strong>State</strong> is extremely reproducible. It is an undeniable benefit of <strong>State</strong> being centralized within a <strong>Store</strong>. We can serialize it, save it on the filesystem and replay it at will. The application will be restored in a similar configuration each time.</li><li>Not only <strong>State</strong> mutations are reproducible but also very testable because they are induced by pure functions free from side effects. All we have to test is <strong>Reducers</strong>' outputs consistency given a stable input.</li></ul><p>I find this approach very interesting compared to the more traditional patterns, because it takes care of the consistency of your application state. MVC, MVP, MVVM or VIPER help you slice your application into well defined layers but they don't guide you so much when it comes to handle the state of your app.</p><p>That's it for the first part of this topic. We've learned a lot about the basics of State Container Architectures. <a href="/posts/2018-06-25-RxReduce-Part2">In part 2</a>, we will dive in a Reactive implementation called RxReduce that will help you handle the state, its mutations and the asynchronous work related to the side effects.</p><p>Stay tuned.</p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="/Images/avatar.png" alt="Thibault Wittemberg"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Thibault Wittemberg</p><p class="text-gray-600 text-xs md:text-base">Mobile Solution Architect in France üá´üá∑ (thibault.wittemberg@gmail.com)</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2018-01-02-ProtocolOrientedTipsMvvm" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2018-01-02-ProtocolOrientedTipsMvvm/POP-MVVM.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">TIPS, ARCHITECTURE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Protocol Oriented Tips For MVVM in Swift</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">Hi folks. Lately MVVM has become some sort of standard as an architecture for iOS apps. It offers a good separation of concerns, a good way to format data and great view binding mechanisms with frameworks such as RxSwift. In this post I will give few tips I use to ease the implementation of this pattern.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">8 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2017-12-22-RxFlow-Part3" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2017-12-22-RxFlow-Part3/RxFlow_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">OPEN SOURCE, REACTIVE PROGRAMMING</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxFlow Part 3: Tips and tricks</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">This is the final chapter of our journey within RxFlow. I‚Äôve already exposed all the key features/principles of the framework in these 2 previous parts, let‚Äôs dive into some tips and tricks I used thanks to Reactive Programming.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">8 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2018-06-25-RxReduce-Part2" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2018-06-25-RxReduce-Part2/RxReduce_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, REACTIVE PROGRAMMING, OPEN SOURCE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxReduce: Reactive State Container Architecture Part 2</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">As we saw in ‚ÄúRxReduce: A Reactive State Container Architecture Part 1‚Äù, State is a central concern in applications. I strongly invite you to take a look at this first article. So far, we haven‚Äôt introduced the concept of Reactive Programming and how it can address some issues I‚Äôve encountered in traditional implementations of State Containers. We will see how RxReduce, an open source framework of the RxSwiftCommunity, can help you handle the State, its mutations, and the asynchronous work related to the side effects, in a Reactive way.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">11 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Warp your mobile development</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>