<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Warp your mobile development"/><link rel="canonical" href="http://blog.warpfactor.io/posts/2017-11-22-VersatileNamespace"/><meta name="twitter:url" content="http://blog.warpfactor.io/posts/2017-11-22-VersatileNamespace"/><meta name="og:url" content="http://blog.warpfactor.io/posts/2017-11-22-VersatileNamespace"/><title>Versatile Namespace | Warp your mobile development</title><meta name="twitter:title" content="Versatile Namespace | Warp your mobile development"/><meta name="og:title" content="Versatile Namespace | Warp your mobile development"/><meta name="description" content="In Swift, some APIs such as RxSwift use a technic that confines the code they‚Äôre exposing in a dedicated namespace. In this post we will figure out how this is done in the most generic and versatile way."/><meta name="twitter:description" content="In Swift, some APIs such as RxSwift use a technic that confines the code they‚Äôre exposing in a dedicated namespace. In this post we will figure out how this is done in the most generic and versatile way."/><meta name="og:description" content="In Swift, some APIs such as RxSwift use a technic that confines the code they‚Äôre exposing in a dedicated namespace. In this post we will figure out how this is done in the most generic and versatile way."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Warp your mobile development"/></head><head>                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109460106-1"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'UA-109460106-1');
                </script></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üçé</span><span class="hidden md:block w-0 md:w-auto pl-1">Warp your mobile development</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/projects">PROJECTS</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/posts">MY POSTS</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">22 NOVEMBER 2017<span class="text-gray-900 px-1">/</span><a href="/tags/tips">TIPS</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">Versatile Namespace</h1></div><div class="container w-full max-w-6xl h-48 md:h-cover mx-auto bg-white bg-cover bg-center mt-8 sm:rounded" style="background-color: #465059; background-image:url('/Images/2017-11-22-VersatileNamespace/space.jpg');"></div><div class="container max-w-5xl mx-auto md:-mt-32"><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><p>In Swift, some APIs such as RxSwift use a technic that confines the code they‚Äôre exposing in a dedicated namespace. In this post we will figure out how this is done in the most generic and versatile way.</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">myButton</span> <span class="p">=</span> <span class="bp">UIButton</span><span class="p">()</span>
<span class="n">myButton</span><span class="p">.</span><span class="n">rx</span><span class="p">.</span><span class="n">tap</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="err">‚Ä¶</span><span class="p">)</span> <span class="c1">// this is a RxCocoa kind of code</span>
</div></code></pre><p>Have you ever wondered how is it possible in Swift to write such a line of code ?</p><p>This is the <strong>.rx.</strong> part that seems awkward at first glance, isn‚Äôt it ? It acts like some kind of custom namespace.</p><ul><li>Is this a variable ?</li><li>Is this an inner class ?</li></ul><p>We have some clues to figure that out:</p><ul><li>As it is accessible via a dot notation. it must be a member of the UIButton class</li><li>It as some properties such as <strong>tap</strong>, so it is a data structure</li></ul><p>With these two clues we can try to make our very own namespace.</p><h1>Step 1: The naive and not so useful approach</h1><p>In the following examples we will try to add a custom name space to UIButton that exposes a single function <strong>hello</strong>.</p><p>As the namespace must be a data structure, let‚Äôs try with a Swift struct:</p><pre><code><div class="highlight"><span></span><span class="kd">struct</span> <span class="nc">ButtonNameSpace</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">hello</span> <span class="p">()</span> <span class="p">{</span>
        <span class="bp">print</span> <span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>So far so good. Since the namespace should be a member of UIButton, we will add it as a computed property:</p><pre><code><div class="highlight"><span></span><span class="kd">extension</span> <span class="bp">UIButton</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">nameSpace</span><span class="p">:</span> <span class="n">ButtonNameSpace</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ButtonNameSpace</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>Now, we can use it like that:</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">myButton</span> <span class="p">=</span> <span class="bp">UIButton</span><span class="p">()</span>
<span class="n">myButton</span><span class="p">.</span><span class="n">nameSpace</span><span class="p">.</span><span class="n">hello</span><span class="p">()</span>
</div></code></pre><p>The result of this call will be: ‚Äú<strong>Hello</strong>‚Äù.</p><p>What can this be used for ? Nothing interesting I would say because in the namespace we cannot access the UIButton properties and functions. We will only do some UIButton external stuff, it would be great to add some <strong>context</strong>&nbsp;to our namespace.</p><h1>Step 2: The useful approach</h1><p>In order to access the UIButton properties and functions, we have to give a reference on this button to the data structure used for the namespace.</p><pre><code><div class="highlight"><span></span><span class="kd">struct</span> <span class="nc">ButtonNameSpace</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">button</span><span class="p">:</span> <span class="bp">UIButton</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">with</span> <span class="n">button</span><span class="p">:</span> <span class="bp">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">button</span> <span class="p">=</span> <span class="n">button</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">hello</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">title</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">button</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
        <span class="bp">print</span> <span class="p">(</span><span class="s">&quot;Hello </span><span class="si">\(</span><span class="n">title</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>The <strong>ButtonNameSpace</strong> struct holds a reference on the UIButton that creates it.</p><p>We still add a computed property to UIButton, and when the <strong>ButtonNameSpace</strong> is created, we pass a reference to the button itself. We can now access the button properties, such as the <strong>title</strong>.</p><pre><code><div class="highlight"><span></span><span class="kd">extension</span> <span class="bp">UIButton</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">nameSpace</span><span class="p">:</span> <span class="n">ButtonNameSpace</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ButtonNameSpace</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>We can still use it like that:</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">myButton</span> <span class="p">=</span> <span class="bp">UIButton</span><span class="p">()</span>
<span class="n">myButton</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&quot;My button&quot;</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>
<span class="n">myButton</span><span class="p">.</span><span class="n">nameSpace</span><span class="p">.</span><span class="n">hello</span><span class="p">()</span>
</div></code></pre><p>The result of this call will be: ‚Äú<strong>Hello My Button</strong>‚Äù. The namespace makes a lot more sense here as it is related to the object within which it is created.</p><p>What if we had to write a namespace for UIImage for instance ? In the actual approach we should declare a <strong>ImageNameSpace</strong>&nbsp;struct as well.</p><p>Actually the true goal of such a struct is to hold a reference on the object in which it is created. It sounds like generics could be involved in this ? No ?</p><h1>Step 3: The best approach</h1><p>The answer is <strong>YES</strong>. This struct <strong>MUST</strong> be generic.</p><pre><code><div class="highlight"><span></span><span class="kd">struct</span> <span class="nc">MyNameSpace</span><span class="p">&lt;</span><span class="n">Base</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">base</span><span class="p">:</span> <span class="n">Base</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">with</span> <span class="n">base</span><span class="p">:</span> <span class="n">Base</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">base</span> <span class="p">=</span> <span class="n">base</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>As we can see, the only purpose of this struct is to hold a reference on <strong>something</strong>&nbsp;that is given as an init parameter so that we can access it in further calls.</p><p>Now, we can use something really great in Swift: <strong>conditional extensions</strong>. It will allow us to add features to this struct only and only if <strong>Base</strong>&nbsp;matches the type we want. For instance, if <strong>Base</strong>&nbsp;is a <strong>UIButton</strong>&nbsp;we add a <strong>Hello</strong>&nbsp;function that will perform the same stuff than the old <strong>ButtonNameSpace</strong>:</p><pre><code><div class="highlight"><span></span><span class="kd">extension</span> <span class="nc">MyNameSpace</span> <span class="k">where</span> <span class="n">Base</span><span class="p">:</span> <span class="bp">UIButton</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">hello</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">title</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">base</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
        <span class="bp">print</span> <span class="p">(</span><span class="s">&quot;Hello </span><span class="si">\(</span><span class="n">title</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>Instead of accessing <strong>self.button.title</strong>, we can access <strong>self.base.title</strong>&nbsp;as we know that <strong>base</strong> is a UIButton for sure. We can add a computed property to UIButton by taking care of the name space genericity.</p><pre><code><div class="highlight"><span></span><span class="kd">extension</span> <span class="bp">UIButton</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">myNameSpace</span><span class="p">:</span> <span class="n">MyNameSpace</span><span class="p">&lt;</span><span class="bp">UIButton</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">MyNameSpace</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>The usage and the result are still the same.</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">myButton</span> <span class="p">=</span> <span class="bp">UIButton</span><span class="p">()</span>
<span class="n">myButton</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&quot;My button&quot;</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>
<span class="n">myButton</span><span class="p">.</span><span class="n">myNameSpace</span><span class="p">.</span><span class="n">hello</span><span class="p">()</span>
</div></code></pre><p>Let‚Äôs get back to the UIImage case. It is no more necessary to define a dedicated namespace struct, we can use our generic one combined to a new conditional extension.</p><pre><code><div class="highlight"><span></span><span class="kd">extension</span> <span class="bp">UIImage</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">myNameSpace</span><span class="p">:</span> <span class="n">MyNameSpace</span><span class="p">&lt;</span><span class="bp">UIImage</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">MyNameSpace</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">MyNameSpace</span> <span class="k">where</span> <span class="n">Base</span><span class="p">:</span> <span class="bp">UIImage</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">hello</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">title</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">base</span><span class="p">.</span><span class="n">accessibilityHint</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
        <span class="bp">print</span> <span class="p">(</span><span class="s">&quot;Hello </span><span class="si">\(</span><span class="n">title</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">myImage</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">()</span>
<span class="n">myImage</span><span class="p">.</span><span class="n">accessibilityHint</span> <span class="p">=</span> <span class="s">&quot;My Image&quot;</span>
<span class="n">myImage</span><span class="p">.</span><span class="n">myNameSpace</span><span class="p">.</span><span class="n">hello</span><span class="p">()</span>
</div></code></pre><p>In fact this is exactly the way RxSwift has implemented the <strong>rx</strong>&nbsp;name space as we can see here: <a href="https://github.com/ReactiveX/RxSwift/blob/0b66f666ba6955a51cba1ad530311b030fa4db9c/RxSwift/Reactive.swift">Reactive.swift</a></p><p>Hope this helps.</p><p>Stay tuned.</p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="/Images/avatar.png" alt="Thibault Wittemberg"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Thibault Wittemberg</p><p class="text-gray-600 text-xs md:text-base">Mobile Solution Architect in France üá´üá∑ (thibault.wittemberg@gmail.com)</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2017-11-08-RxFlow-Part1" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2017-11-08-RxFlow-Part1/RxFlow_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">OPEN SOURCE, REACTIVE PROGRAMMING</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxFlow Part 1: In Theory</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">This is a first article in a series that will be the heart of this blog for a while. I‚Äôm going to introduce RxFlow: a framework of my design implementing Reactive Flow Coordinator within iOS applications. RxFlow relies on RxSwift and is a project supported by the RxSwiftCommunity.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">5 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2020-03-26-Spin" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2020-03-26-Spin/header.jpeg" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, REACTIVE PROGRAMMING, FUNCTIONAL PROGRAMMING, OPEN SOURCE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Introducing Spin</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">Introducing Spin, a universal feedback loop system in Swift. A Feedback Loop is a system that is able to self-regulate by using the resulting value from its computations as the next input to itself, constantly adjusting this value according to given rules.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">13 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2019-06-18-PropertyWrappers" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2019-06-18-PropertyWrappers/wrapper.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">LANGUAGE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Property Wrappers In Swift 5.1, The Missing Published Implementation</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">It‚Äôs been an amazing WWDC this year. SwiftUI and Combine were some big announcements of the conference. They will have a huge impact on our daily life as iOS developers.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">6 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Warp your mobile development</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>