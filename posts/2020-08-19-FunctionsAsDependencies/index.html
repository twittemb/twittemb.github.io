<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Warp your mobile development"/><link rel="canonical" href="http://blog.warpfactor.io/posts/2020-08-19-FunctionsAsDependencies"/><meta name="twitter:url" content="http://blog.warpfactor.io/posts/2020-08-19-FunctionsAsDependencies"/><meta name="og:url" content="http://blog.warpfactor.io/posts/2020-08-19-FunctionsAsDependencies"/><title>Functions as dependencies in Swift | Warp your mobile development</title><meta name="twitter:title" content="Functions as dependencies in Swift | Warp your mobile development"/><meta name="og:title" content="Functions as dependencies in Swift | Warp your mobile development"/><meta name="description" content="Implementing an architecture within an application can be challenging. There are rules we can follow (SOLID, Clean Architecture) and patterns to guide us (MVVM, MVP, MVI, Redux, ‚Ä¶) but sometimes, things we thought were well established deserve a step back."/><meta name="twitter:description" content="Implementing an architecture within an application can be challenging. There are rules we can follow (SOLID, Clean Architecture) and patterns to guide us (MVVM, MVP, MVI, Redux, ‚Ä¶) but sometimes, things we thought were well established deserve a step back."/><meta name="og:description" content="Implementing an architecture within an application can be challenging. There are rules we can follow (SOLID, Clean Architecture) and patterns to guide us (MVVM, MVP, MVI, Redux, ‚Ä¶) but sometimes, things we thought were well established deserve a step back."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Warp your mobile development"/></head><head>                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109460106-1"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'UA-109460106-1');
                </script></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üçé</span><span class="hidden md:block w-0 md:w-auto pl-1">Warp your mobile development</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/projects">PROJECTS</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/posts">MY POSTS</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">19 AUGUST 2020<span class="text-gray-900 px-1">/</span><a href="/tags/architecture">ARCHITECTURE</a>, <a href="/tags/functional-programming">FUNCTIONAL PROGRAMMING</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">Functions as dependencies in Swift</h1></div><div class="container w-full max-w-6xl h-48 md:h-cover mx-auto bg-white bg-cover bg-center mt-8 sm:rounded" style="background-color: #465059; background-image:url('/Images/2020-08-19-FunctionsAsDependencies/header.png');"></div><div class="container max-w-5xl mx-auto md:-mt-32"><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><h1>Introduction</h1><p>Implementing an architecture within an application can be challenging. There are rules we can follow (SOLID, Clean Architecture) and patterns to guide us (MVVM, MVP, MVI, Redux, ‚Ä¶) but sometimes, things we thought were well established deserve a step back.</p><p>Lately, I‚Äôve been in this situation while developing an application that relied on the use of <a href="https://en.wikipedia.org/wiki/Higher-order_function">higher order free functions</a>. In this article, I‚Äôll try to guide you from the sparkle that lit this desire for higher order free functions to its implementation regarding dependency injection.</p><h1>Dependency Injection</h1><p>Dependency injection is a technique at the crossroads of well known software engineering best practices: abstraction and decoupling, single responsibility, dependency inversion. It provides flexible and testable implementations. This article assumes that the merits of dependency injection are accepted. We will see how dependency injection and higher order functions fit very well together.</p><h1>Implementation in a traditional way</h1><p>In the rest of this article we will focus on a UsersRepository object that fetches users from a Rest API and filters them out before returning them. For the sake of the demonstration all the endpoints of this API return users but with different flavours depending on the fetched route.</p><p>To do so the UsersRepository will be injected with an ApiService protocol whose purpose is to provide a way to fetch users from the Rest endpoints:</p><pre><code><div class="highlight"><span></span><span class="kd">protocol</span> <span class="nc">ApiService</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">route</span><span class="p">:</span> <span class="n">Route</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">ApiError</span><span class="p">&gt;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">UsersRepository</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">apiService</span><span class="p">:</span> <span class="n">ApiService</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">apiService</span><span class="p">:</span> <span class="n">ApiService</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">apiService</span> <span class="p">=</span> <span class="n">apiService</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">loadAllUsers</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">allUsersRoute</span> <span class="p">=</span> <span class="n">Route</span><span class="p">(</span><span class="s">&quot;/api/users/all&quot;</span><span class="p">)</span>
        <span class="kc">self</span>
            <span class="p">.</span><span class="n">apiService</span>
            <span class="p">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">route</span><span class="p">:</span> <span class="n">allUsersRoute</span><span class="p">)</span>
            <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isActive</span> <span class="p">}</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">UsersRepositoryError</span><span class="p">.</span><span class="n">someError</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>This is a pretty common implementation. Of course, in real life implementation, we would try to make the ApiService more versatile and safe by using generic types and constraints.</p><p>As I said in the introduction, let‚Äôs give it a second thought ‚Ä¶ why an ApiService ?</p><p>In fact, we just want to retrieve users, the repository doesn‚Äôt care about where they come from, it is an implementation detail. A Rest API is one way among many.</p><p>A trivial approach would be to refactor the ApiService into a more versatile DataProvider protocol.</p><p>But what about its definition?</p><ul><li>the ‚Äúfetch‚Äù function doesn‚Äôt really make sense anymore</li><li>the ‚Äúroute‚Äù parameter becomes irrelevant outside an API context</li><li>the ‚ÄúApiError‚Äù type is too specific</li></ul><p>Of course, we could find a way to pick more ¬´ any purpose ¬ª names and data structures but I invite you to look for another way.</p><h1>Injecting functions</h1><p>After all, the UsersRepository only relies on an AnyPublisher&lt;[User], ApiError&gt; to perform its work, right ?</p><p>The temptation is strong to directly inject this publisher as a dependency, but we should not. Injecting it directly would mean to build this publisher pretty early in the injection process and this is something that might lead to unwanted side effects: perhaps it takes time to be built or it needs other dependencies to be resolved ? The UsersRepository doesn‚Äôt know that and can make no assumption on that. The publisher should only be built if and when needed.</p><p>If we can‚Äôt inject the publisher, we can inject a function that builds it üëç, and execute it at our convenience.</p><p>Let‚Äôs give it a try then.</p><pre><code><div class="highlight"><span></span><span class="kd">class</span> <span class="nc">UsersRepository</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="n">RetrieveUsersFunction</span> <span class="p">=</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">retrieveUsersFunction</span><span class="p">:</span> <span class="n">RetrieveUsersFunction</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">retrieveUsersFunction</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="n">RetrieveUsersFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">retrieveUsersFunction</span> <span class="p">=</span> <span class="n">retrieveUsersFunction</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">loadUsers</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">retrieveUsersFunction</span><span class="p">()</span>
            <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isActive</span> <span class="p">}</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">UsersRepositoryError</span><span class="p">.</span><span class="n">someError</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>What have we done here:</p><ul><li>To ease the reading, we‚Äôve declared a typealias describing the function signature</li><li>We‚Äôve injected the function</li><li>We‚Äôve used the function as a replacement of the ApiService</li><li>The publisher signature has changed a bit, from AnyPublisher&lt;[User], ApiError&gt; to AnyPublisher&lt;[User], Error&gt;. We do not want to leak implementation details here because of the error type.</li></ul><p>So far so good ‚Ä¶ but what about the Route we used to pass to the fetch function ? In fact we don‚Äôt need it anymore as it was specific to the ApiService; nevertheless, we will cover this precise point later in this article.</p><p>As a bonus we can also inject the filtering function so we can change its behaviour depending on the context (the filter might differ between dev, QA or prod environment for instance).</p><pre><code><div class="highlight"><span></span><span class="kd">class</span> <span class="nc">UsersRepository</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="n">RetrieveUsersFunction</span> <span class="p">=</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span>
    <span class="kd">typealias</span> <span class="n">FilterUserFunction</span> <span class="p">=</span> <span class="p">(</span><span class="n">User</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span>

    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">retrieveUsersFunction</span><span class="p">:</span> <span class="n">RetrieveUsersFunction</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">filterUserFunction</span><span class="p">:</span> <span class="n">FilterUserFunction</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">retrieveUsersFunction</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="n">RetrieveUsersFunction</span><span class="p">,</span>
         <span class="n">filterUserFunction</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="n">FilterUserFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">retrieveUsersFunction</span> <span class="p">=</span> <span class="n">retrieveUsersFunction</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">filterUserFunction</span> <span class="p">=</span> <span class="n">filterUserFunction</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">loadUsers</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">retrieveUsersFunction</span><span class="p">()</span>
            <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="p">[</span><span class="n">filterUserFunction</span><span class="p">]</span> <span class="k">in</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">filter</span><span class="p">(</span><span class="n">filterUserFunction</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">UsersRepositoryError</span><span class="p">.</span><span class="n">someError</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>Once again we take advantage of typealiases to pass the functions around. This becomes almost mandatory when using functions as dependencies.</p><p>While we are at it, perhaps we can push our reflexion a bit further and take a final step towards the systematic use of functions.</p><p>Why do we need a repository ? Usually, the repository pattern is used to group all the CRUD operations about an entity. We can assume that a UsersRepository will have several load, update, and delete functions. Once implemented, those functions will require a certain number of dependencies. We will end up with an initializer taking all the needed functions as parameters, whereas we might only need some of them depending on the feature we want to accomplish. This is not optimal.</p><p>Getting rid of the repository implies that every function (load, update, delete ‚Ä¶) is self-supporting and is being injected only with the needed dependencies.</p><pre><code><div class="highlight"><span></span><span class="kd">typealias</span> <span class="n">RetrieveUsersFunction</span> <span class="p">=</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span><span class="p">&gt;</span>
<span class="kd">typealias</span> <span class="n">FilterUserFunction</span> <span class="p">=</span> <span class="p">(</span><span class="n">User</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span>

<span class="kd">static</span> <span class="kd">func</span> <span class="nf">loadUsers</span><span class="p">(</span>
    <span class="n">retrieveUsersFunction</span><span class="p">:</span> <span class="n">RetrieveUsersFunction</span><span class="p">,</span>
    <span class="n">filterUserFunction</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="n">FilterUserFunction</span>
<span class="p">)</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="n">retrieveUsersFunction</span><span class="p">()</span>
        <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">filter</span><span class="p">(</span><span class="n">filterUserFunction</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">UsersError</span><span class="p">.</span><span class="n">someError</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
<span class="p">}</span>
</div></code></pre><p>Here we go, we have a 100% autonomous function. For the sake of clarity we can wrap the whole thing inside a namespace to shorten some names:</p><pre><code><div class="highlight"><span></span><span class="kd">enum</span> <span class="nc">Users</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nc">Error</span><span class="p">:</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">someError</span>
    <span class="p">}</span>

    <span class="kd">typealias</span> <span class="n">RetrieveFunction</span> <span class="p">=</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span><span class="p">&gt;</span>
    <span class="kd">typealias</span> <span class="n">FilterFunction</span> <span class="p">=</span> <span class="p">(</span><span class="n">User</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">load</span><span class="p">(</span>
        <span class="n">retrieveFunction</span><span class="p">:</span> <span class="n">RetrieveFunction</span><span class="p">,</span>
        <span class="n">filterFunction</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="n">FilterFunction</span> <span class="p">=</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isActive</span> <span class="p">}</span>
    <span class="p">)</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">retrieveFunction</span><span class="p">()</span>
            <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">filter</span><span class="p">(</span><span class="n">filterFunction</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">Users</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">someError</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><blockquote><p>We can also have a default value for the filterFunction parameter to make a more concise API</p></blockquote><h1>The positive impact on the unit tests</h1><p>Let‚Äôs get back to the original UsersRepository implementation. In order to unit test the loadUsers function, we would have had to create a mocked ApiService to fulfill the initializer requirements. The mocked ApiService should be able to succeed or fail in order to test the output of the loadUsers function.</p><p>In the unfortunate case where the ApiService also needs a dependency on its own, then we would have been forced to implement another mocked dependency as well. If we apply that strategy to the whole application, we might end up with a complex hierarchy of mock objects.</p><p>When using functions as dependencies, we still need mocks of course, but they are in general very small, simple and defined right next to the unit test:</p><pre><code><div class="highlight"><span></span><span class="kd">func</span> <span class="nf">test_loadUsers_return_users_when_dependencies_succeed</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Given: a retrieve function that succeeds at getting some Users</span>
    <span class="kd">let</span> <span class="nv">successRetrieveFunction</span> <span class="p">=</span> <span class="p">{</span>
        <span class="n">Just</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">]</span><span class="o">&gt;</span><span class="p">([</span><span class="n">User</span><span class="p">(</span><span class="n">isActive</span><span class="p">:</span> <span class="kc">true</span><span class="p">),</span> <span class="n">User</span><span class="p">(</span><span class="n">isActive</span><span class="p">:</span> <span class="kc">false</span><span class="p">)])</span>
            <span class="p">.</span><span class="n">setFailureType</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">mockFilterFunction</span> <span class="p">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="k">in</span> <span class="k">return</span> <span class="kc">true</span> <span class="p">}</span>

    <span class="c1">// When: loading the users</span>
    <span class="kd">let</span> <span class="nv">users</span> <span class="p">=</span> <span class="n">Users</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">retrieveFunction</span><span class="p">:</span> <span class="n">successRetrieveFunction</span><span class="p">,</span>
                           <span class="n">filterFunction</span><span class="p">:</span> <span class="n">mockFilterFunction</span><span class="p">)</span>

    <span class="c1">// Then: we can make assertions about the retrieved users</span>
    <span class="c1">// XCTAssert(...)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">test_loadUsers_return_error_when_dependencies_fail</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Given: a retrieve function that fails at getting some Users</span>
    <span class="kd">let</span> <span class="nv">failureRetrieveFunction</span> <span class="p">=</span> <span class="p">{</span>
        <span class="n">Fail</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span><span class="p">&gt;(</span><span class="n">error</span><span class="p">:</span> <span class="bp">NSError</span><span class="p">(</span><span class="n">domain</span><span class="p">:</span> <span class="s">&quot;domain.mock&quot;</span><span class="p">,</span>
                                                 <span class="n">code</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">mockFilterFunction</span> <span class="p">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="k">in</span> <span class="k">return</span> <span class="kc">true</span> <span class="p">}</span>

    <span class="c1">// When: loading the users</span>
    <span class="kd">let</span> <span class="nv">users</span> <span class="p">=</span> <span class="n">Users</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">retrieveFunction</span><span class="p">:</span> <span class="n">failureRetrieveFunction</span><span class="p">,</span>
                           <span class="n">filterFunction</span><span class="p">:</span> <span class="n">mockFilterFunction</span><span class="p">)</span>

    <span class="c1">// Then: we can make assertions about the received error</span>
    <span class="c1">// XCTAssert(...)</span>
<span class="p">}</span>
</div></code></pre><p>Unit tests are super easy to imagine, to write, and to read. Personally, I find this technique a very good tool to reach a high (and meaningful) code coverage. I think it can help a lot when using a TDD approach.</p><h1>A trick from functional programming</h1><p>Do you remember the original implementation of the UsersRepository: it used an ApiService to fetch an endpoint defined by a route. Even though this has been erased by the abstraction brought by the injection of functions, at the end we still need to provide a function that can retrieve users for real. It is up to the dependency injection mechanism to provide a compatible concrete implementation.</p><p>We have an ApiService at our disposal but the fetch definition does not match the signature we need:</p><pre><code><div class="highlight"><span></span><span class="p">(</span><span class="n">Route</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">ApiError</span><span class="p">&gt;</span>

                <span class="n">VS</span>

<span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span><span class="p">&gt;</span>
</div></code></pre><p>We need to perform two changes here:</p><ul><li>Erase the Route parameter</li><li>Change the error type</li></ul><p>To erase the Route parameter we can borrow some techniques from the functional programming like partial functions or currying. We will go with partial functions here, even though currying could be a reasonable choice as well.</p><p>Partializing a function is like saying to the compiler ¬´ Hey, I know some parameters of this function, I can set them right now, but the rest of the parameters are still undefined, please give me back a function that will only take those parameters so I can call it later!¬ª</p><p>Let‚Äôs take a look at an example üòè.</p><p>dumbFunction is a function that takes two parameters and returns a Bool.</p><pre><code><div class="highlight"><span></span><span class="kd">func</span> <span class="nf">dumbFunction</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">param2</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
    <span class="c1">// Does some smart calculations and returns a Bool</span>
<span class="p">}</span>
</div></code></pre><p>We can partialize that function to be able to ¬´ freeze ¬ª the first parameter and get back in return a function that only takes the second one.</p><pre><code><div class="highlight"><span></span><span class="kd">func</span> <span class="nf">partializedDumbFunction</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="p">(</span><span class="n">unknownParam2</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="k">in</span>
        <span class="k">return</span> <span class="n">dumbFunction</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">:</span> <span class="n">unknownParam2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>Now, instead of using the function ‚ÄòdumbFunction‚Äô with 2 parameters, we can use its partialized counterpart with only one parameter</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">dumbFunctionWithOneFixedParameter</span> <span class="p">=</span> <span class="n">partializedDumbFunction</span><span class="p">(</span><span class="s">&quot;Param1&quot;</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">dumbFunctionWithOne</span> <span class="p">=</span> <span class="n">dumbFunctionWithOneFixedParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">dumbFunctionWithTwo</span> <span class="p">=</span> <span class="n">dumbFunctionWithOneFixedParameter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</div></code></pre><p>It is a little bit like if we had performed dependency injection of the first parameter, the partialization has ¬´ captured ¬ª it.</p><p>Of course, we cannot write a partialized version of every function in our code base. There is a way to make it generic with any numbers of parameters.</p><pre><code><div class="highlight"><span></span><span class="kd">func</span> <span class="nf">partial</span><span class="p">&lt;</span><span class="n">Arg1</span><span class="p">,</span> <span class="n">Result</span><span class="p">&gt;(</span>
    <span class="kc">_</span> <span class="n">function</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">Arg1</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Result</span><span class="p">,</span>
    <span class="n">arg1</span><span class="p">:</span> <span class="n">Arg1</span>
<span class="p">)</span> <span class="p">-&gt;</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Result</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">function</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">partial</span><span class="p">&lt;</span><span class="n">Arg1</span><span class="p">,</span> <span class="n">Arg2</span><span class="p">,</span> <span class="n">Result</span><span class="p">&gt;(</span>
    <span class="kc">_</span> <span class="n">function</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">Arg1</span><span class="p">,</span> <span class="n">Arg2</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Result</span><span class="p">,</span>
    <span class="n">arg1</span><span class="p">:</span> <span class="n">Arg1</span>
<span class="p">)</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">Arg2</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Result</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="p">(</span><span class="n">unkownArg2</span><span class="p">:</span> <span class="n">Arg2</span><span class="p">)</span> <span class="k">in</span>
        <span class="n">function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">unkownArg2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">partial</span><span class="p">&lt;</span><span class="n">Arg1</span><span class="p">,</span> <span class="n">Arg2</span><span class="p">,</span> <span class="n">Result</span><span class="p">&gt;(</span>
    <span class="kc">_</span> <span class="n">function</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">Arg1</span><span class="p">,</span> <span class="n">Arg2</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Result</span><span class="p">,</span>
    <span class="n">arg2</span><span class="p">:</span> <span class="n">Arg2</span>
<span class="p">)</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">Arg1</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Result</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="p">(</span><span class="n">unkownArg1</span><span class="p">:</span> <span class="n">Arg1</span><span class="p">)</span> <span class="k">in</span>
        <span class="n">function</span><span class="p">(</span><span class="n">unkownArg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>And we can write as much versions of partial functions as needed.</p><p>Do you see where I‚Äôm going here ? We went from a function with two parameters to a function with only one. Then, we can go from a function with one parameter to a function with none !</p><p>Let‚Äôs get back to the <em>ApiService.fetch</em> function and apply a partialization on it:</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">apiService</span> <span class="p">=</span> <span class="n">MyApiService</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">usersRoute</span> <span class="p">=</span> <span class="n">Route</span><span class="p">(</span><span class="s">&quot;/api/users/all&quot;</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">partializedFetchFunction</span> <span class="p">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">apiService</span><span class="p">.</span><span class="n">fetch</span><span class="p">,</span> <span class="n">arg1</span><span class="p">:</span> <span class="n">usersRoute</span><span class="p">)</span>
</div></code></pre><p>We now have a partialized function with the signature:</p><p><strong>() -&gt; AnyPublisher&lt;[User], ApiError&gt;</strong>, the route parameter has been captured by the partialization and will be used when executing <strong>partializedFetchFunction</strong>.</p><p>We‚Äôre almost there, all we need to do is hide the ApiError, fortunately Combine can help use with that:</p><pre><code><div class="highlight"><span></span><span class="p">...</span>
<span class="kd">let</span> <span class="nv">retrieveUsersFunction</span><span class="p">:</span> <span class="n">Users</span><span class="p">.</span><span class="n">RetrieveFunction</span> <span class="p">=</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">partializedFetchFunction</span><span class="p">()</span>
        <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">as</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
<span class="p">}</span>
</div></code></pre><p>Aaaaaand we have our dependency ! the retrieveUsersFunction has that signature: <strong>() -&gt; AnyPublisher&lt;[User], Swift.Error&lg;</strong></p><p>We can inject it in the Users.load function üëå.</p><h1>Sum up</h1><h2>1: use function as dependencies:</h2><pre><code><div class="highlight"><span></span><span class="kd">enum</span> <span class="nc">Users</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nc">Error</span><span class="p">:</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">someError</span>
    <span class="p">}</span>

    <span class="kd">typealias</span> <span class="n">RetrieveFunction</span> <span class="p">=</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span><span class="p">&gt;</span>
    <span class="kd">typealias</span> <span class="n">FilterFunction</span> <span class="p">=</span> <span class="p">(</span><span class="n">User</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">load</span><span class="p">(</span>
        <span class="n">retrieveFunction</span><span class="p">:</span> <span class="n">RetrieveFunction</span><span class="p">,</span>
        <span class="n">filterFunction</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="n">FilterFunction</span> <span class="p">=</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isActive</span> <span class="p">}</span>
    <span class="p">)</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">User</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">retrieveFunction</span><span class="p">()</span>
            <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">filter</span><span class="p">(</span><span class="n">filterFunction</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">Users</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">someError</span> <span class="p">}</span>
            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><h2>2: use partialization to build the dependencies:</h2><pre><code><div class="highlight"><span></span><span class="p">...</span>
<span class="kd">let</span> <span class="nv">retrieveUsersFunction</span><span class="p">:</span> <span class="n">Users</span><span class="p">.</span><span class="n">RetrieveFunction</span> <span class="p">=</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">partializedFetchFunction</span><span class="p">()</span>
        <span class="p">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">as</span> <span class="n">Swift</span><span class="p">.</span><span class="n">Error</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
<span class="p">}</span>
</div></code></pre><h2>3: inject the dependency</h2><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">users</span> <span class="p">=</span> <span class="n">Users</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">retrieveFunction</span><span class="p">:</span> <span class="n">retrieveUsersFunction</span><span class="p">,</span>
<span class="n">filterFunction</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isActive</span> <span class="p">})</span>
</div></code></pre><p>The most delicate part is the second one as it asks some plumbing and boilerplate, but it should be segregated in specific areas of your code dedicated to dependency injection, like Swinject Assemblies for instance.</p><h1>Conclusion</h1><p>Although injecting traditional data structures is perfectly fine and is in line with best practices, injecting functions offers two major benefits:</p><ul><li>This puts under a new light how easy it is to leak the implementation details and how we can avoid it. The less we know about our dependencies, the better. I guess this illustrates perfectly the <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a></li><li>This makes unit tests easier to write, to read, and to reason about</li></ul><p>Using functions ¬´ everywhere ¬ª can have some unpleasant aspects like making signatures hard to read for instance. But this is something we can easily work around by using typealiases.</p><p>Using functions ¬´ everywhere ¬ª also opens the door to functional programming. We had a taste of it with partialization but it is a whole new world that you should gently explore.</p><p>Thanks for reading.</p><p>Stay tuned.</p><h1>Bonus: Swinject and the injection of functions</h1><p>Swinject is a well established dependency injection framework in the Swift community. It is used to register and resolve the ¬´ recipes ¬ª to build your dependencies. But what about registering and resolving functions ?</p><p>There is nothing more like a <strong>(String) -&gt; String</strong> function than another <strong>(String) -&gt; String</strong> function, right !</p><p>What happens if we need to resolve a function that has been registered several time with the same signature ?</p><p>Swinject provides a way to discriminate registered services by using a unique name. If we want to use that in our <strong>(String) -&gt; String</strong> case, we will end up with something like this:</p><pre><code><div class="highlight"><span></span><span class="kd">class</span> <span class="nc">MyAssembly</span><span class="p">:</span> <span class="n">Assembly</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">register</span><span class="p">(</span><span class="n">container</span><span class="p">:</span> <span class="n">Container</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">.</span><span class="n">register</span><span class="p">(((</span><span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span><span class="p">).</span><span class="kc">self</span><span class="p">,</span>
                           <span class="n">name</span><span class="p">:</span> <span class="s">&quot;StringFunction1&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
                            <span class="k">return</span> <span class="p">{</span> <span class="n">param</span> <span class="k">in</span>
                                <span class="k">return</span> <span class="n">param</span> <span class="o">+</span> <span class="s">&quot;JAMES&quot;</span>
                            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">container</span><span class="p">.</span><span class="n">register</span><span class="p">(((</span><span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span><span class="p">).</span><span class="kc">self</span><span class="p">,</span>
                           <span class="n">name</span><span class="p">:</span> <span class="s">&quot;StringFunction2&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
                            <span class="k">return</span> <span class="p">{</span> <span class="n">param</span> <span class="k">in</span>
                                <span class="k">return</span> <span class="n">param</span> <span class="o">+</span> <span class="s">&quot;LEONARD&quot;</span>
                            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>When it comes to resolve things:</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">stringFunction1</span> <span class="p">=</span> <span class="n">resolver</span><span class="p">.</span><span class="n">resolve</span><span class="p">(((</span><span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span><span class="p">).</span><span class="kc">self</span><span class="p">,</span>
<span class="n">name</span><span class="p">:</span> <span class="s">&quot;StringFunction1&quot;</span><span class="p">)</span>
</div></code></pre><p>While there is nothing wrong about that, this is kind of ugly to read. We can improve this a bit with a protocol that groups the function signature and its name:</p><pre><code><div class="highlight"><span></span><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">NamedService</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="n">Service</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">type</span><span class="p">:</span> <span class="n">Service</span><span class="p">.</span><span class="kr">Type</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">extension</span> <span class="nc">NamedService</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">type</span><span class="p">:</span> <span class="n">Service</span><span class="p">.</span><span class="kr">Type</span> <span class="p">{</span>
        <span class="n">Service</span><span class="p">.</span><span class="kc">self</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="s">&quot;</span><span class="si">\(</span><span class="kc">self</span><span class="si">)</span><span class="s">&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// And then we can extend Swinject</span>

<span class="kd">public</span> <span class="kd">extension</span> <span class="nc">Container</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">discardableResult</span>
    <span class="kd">func</span> <span class="nf">register</span><span class="p">&lt;</span><span class="n">Service</span><span class="p">&gt;(</span>
        <span class="n">namedServiceType</span><span class="p">:</span> <span class="n">Service</span><span class="p">.</span><span class="kr">Type</span><span class="p">,</span>
        <span class="n">factory</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">Resolver</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Service</span><span class="p">.</span><span class="n">Service</span>
    <span class="p">)</span> <span class="p">-&gt;</span> <span class="n">ServiceEntry</span><span class="p">&lt;</span><span class="n">Service</span><span class="p">.</span><span class="n">Service</span><span class="p">&gt;</span> <span class="k">where</span> <span class="n">Service</span><span class="p">:</span> <span class="n">NamedService</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">namedServiceType</span><span class="p">.</span><span class="n">type</span><span class="p">,</span>
                      <span class="n">name</span><span class="p">:</span> <span class="n">namedServiceType</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                      <span class="n">factory</span><span class="p">:</span> <span class="n">factory</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">extension</span> <span class="nc">Resolver</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">resolve</span><span class="p">&lt;</span><span class="n">Service</span><span class="p">&gt;(</span>
        <span class="n">namedServiceType</span><span class="p">:</span> <span class="n">Service</span><span class="p">.</span><span class="kr">Type</span>
    <span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Service</span><span class="p">.</span><span class="n">Service</span><span class="p">?</span> <span class="k">where</span> <span class="n">Service</span><span class="p">:</span> <span class="n">NamedService</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">namedServiceType</span><span class="p">.</span><span class="n">type</span><span class="p">,</span>
                     <span class="n">name</span><span class="p">:</span> <span class="n">namedServiceType</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>With that in place, the Swinject assembly now becomes:</p><pre><code><div class="highlight"><span></span><span class="kd">class</span> <span class="nc">MyAssembly</span><span class="p">:</span> <span class="n">Assembly</span> <span class="p">{</span>

    <span class="kd">enum</span> <span class="nc">StringFunction1</span><span class="p">:</span> <span class="n">NamedService</span> <span class="p">{</span>
        <span class="kd">typealias</span> <span class="n">Service</span> <span class="p">=</span> <span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span>
    <span class="p">}</span>

    <span class="kd">enum</span> <span class="nc">StringFunction2</span><span class="p">:</span> <span class="n">NamedService</span> <span class="p">{</span>
        <span class="kd">typealias</span> <span class="n">Service</span> <span class="p">=</span> <span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">register</span><span class="p">(</span><span class="n">container</span><span class="p">:</span> <span class="n">Container</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">namedService</span><span class="p">:</span> <span class="n">StringFunction1</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
            <span class="k">return</span> <span class="p">{</span> <span class="n">param</span> <span class="k">in</span>
                <span class="k">return</span> <span class="n">param</span> <span class="o">+</span> <span class="s">&quot;JAMES&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">container</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">namedService</span><span class="p">:</span> <span class="n">StringFunction2</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
            <span class="k">return</span> <span class="p">{</span> <span class="n">param</span> <span class="k">in</span>
                <span class="k">return</span> <span class="n">param</span> <span class="o">+</span> <span class="s">&quot;LEONARD&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>When it comes to resolve things:</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">stringFunction1</span> <span class="p">=</span> <span class="n">resolver</span><span class="p">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">namedService</span><span class="p">:</span> <span class="n">StringFunction1</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span>
</div></code></pre><p>Even if we do not win that much in doing this, we make the function registration/resolving look like any traditional data structure usage. It removes a pain point in injecting functions that could have prevented you from trying this technique üòè.</p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="/Images/avatar.png" alt="Thibault Wittemberg"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Thibault Wittemberg</p><p class="text-gray-600 text-xs md:text-base">Mobile Solution Architect in France üá´üá∑ (thibault.wittemberg@gmail.com)</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2017-12-09-RxFlow-Part2" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2017-12-09-RxFlow-Part2/RxFlow_Logo.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">OPEN SOURCE, REACTIVE PROGRAMMING</p><div class="w-full font-bold text-2xl text-gray-900 px-6">RxFlow Part 2: In Practice</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">A few weeks ago I introduced in this blog an iOS framework called RxFlow. I‚Äôve been working on this framework for several months, and it is now ready to be used. If you haven‚Äôt read it yet, I suggest you take a look at this post "RxFlow Part1: In Theory".</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">11 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2018-04-02-GlanceAtConditionalConformance" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2018-04-02-GlanceAtConditionalConformance/swift4.1.png" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">LANGUAGE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">A glance at conditional conformance</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">Swift 4.1 is available since a few days now and it comes with an interesting feature: Conditional conformance. This is a new tool for achieving Protocol Oriented Programming as well as API designing. This post is a quick take on this brand new technic and will be followed for sure by deep dive posts in a few weeks.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">8 MIN READ</p></div></div></div><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/posts/2020-03-26-Spin" class="flex flex-wrap no-underline hover:no-underline"><img src="/Images/2020-03-26-Spin/header.jpeg" class="h-64 w-full rounded-t object-cover"/><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">ARCHITECTURE, REACTIVE PROGRAMMING, FUNCTIONAL PROGRAMMING, OPEN SOURCE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Introducing Spin</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">Introducing Spin, a universal feedback loop system in Swift. A Feedback Loop is a system that is able to self-regulate by using the resulting value from its computations as the next input to itself, constantly adjusting this value according to given rules.</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="/Images/avatar.png" alt="Thibault Wittemberg"/><p class="text-gray-600 text-xs md:text-sm">13 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Warp your mobile development</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>